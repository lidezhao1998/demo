<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.w3.org/1999/xhtml">
<head>
    <title>上报添加</title>
    <th:block th:include="include :: header('新增退牧还草工程进度')"/>
    <th:block th:include="include :: datetimepicker-css"/>
</head>
<style>
    input {
        width: 60%;
        height: 20px;
        border: 1px solid #e5e6e7;
        text-align: center;
    }
</style>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-report-add">
        <input id="mapId" name="mapId" type="hidden">
        <input id="province" name="province" type="hidden">
        <input id="resolveId" name="resolveId" type="hidden">
        <input id="city" name="city" type="hidden">
        <input id="wlScale" name="wlScale" type="hidden">
        <input id="wlInvestment" name="wlInvestment" type="hidden">
        <input id="jmSize" name="jmSize" type="hidden">
        <input id="jmMoney" name="jmMoney" type="hidden">
        <input id="xmSize" name="xmSize" type="hidden">
        <input id="xmMoney" name="xmMoney" type="hidden">
        <input id="hqlxSize" name="hqlxSize" type="hidden">
        <input id="hqlxMoney" name="hqlxMoney" type="hidden">
        <input id="smhzlSize" name="smhzlSize" type="hidden">
        <input id="smhzlMoney" name="smhzlMoney" type="hidden">
        <input id="thcyglSize" name="thcyglSize" type="hidden">
        <input id="thcyglMoney" name="thcyglMoney" type="hidden">
        <input id="rgscdSize" name="rgscdSize" type="hidden">
        <input id="rgscdMoney" name="rgscdMoney" type="hidden">
        <input id="hspjSize" name="hspjSize" type="hidden">
        <input id="hspjMoney" name="hspjMoney" type="hidden">
        <input id="httSize" name="httSize" type="hidden">
        <input id="httMoney" name="httMoney" type="hidden">
        <input id="dhcSize" name="dhcSize" type="hidden">
        <input id="dhcMoney" name="dhcMoney" type="hidden">
        <div class="col-sm-12 search-collapse" style="margin-top: 0px">
            <div class="select-list">
                <ul>
                    <li class="select-time">
                        <p>年份：</p>
                        <input type="year" name="year" class="layui-layer-input" placeholder="所有" id="test2"/>
                    </li>
                    <li>
                        <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i
                                class="fa fa-search"></i>&nbsp;搜索</a>
                        <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i
                                class="fa fa-refresh"></i>&nbsp;重置</a>
                    </li>
                </ul>
            </div>
            <div class="form-group">
                <div class="btn-group-sm" id="toolbar" role="group">
                    <!--<a class="btn btn-primary btn-rounded btn-sm" onclick="ht()" style="float: left"
                       shiro:hasPermission="system:report:add">
                        <i class="fa fa-plus"></i> 添加绘图
                    </a>-->
                    <div style="float: left">
                        <span style="float: left;margin-left: 20px;">当前任务完成进度：</span>
                        <div style="float: left">
                            <div id="progress" style="float: left">0%</div>
                            <div class="progress progress-mini" style="float: left;width: 300px;margin: 10px;height: 15px;">
                                <div id="progressBar" style="width: 0%;float:left;height: 15px;background:#50c2c1;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-12 select-table table-bordered">
            <table id="bootstrap-table"></table>
        </div>
        <div class="col-sm-offset-5 col-sm-10" style="margin-top: 15px;">
            <button type="button" class="btn btn-sm btn-primary" th:onclick="submitHandler()"><i
                    class="fa fa-check"></i>上 报
            </button>&nbsp;
            <button type="button" class="btn btn-sm btn-danger" onclick="closeItem()"><i class="fa fa-reply-all"></i>关 闭
            </button>
        </div>
    </form>
</div>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: datetimepicker-js"/>
<script type="text/javascript">
    var prefix = ctx + "system/report";
    let totalScale = 0;//任务量
    let zgmCountSum = 0;//总规模(万亩)
    $(function () {
        var options = {
            url: prefix + "/managerListReport",
            createUrl: prefix + "/cityAdd",
            updateUrl: prefix + "/again/{id}",
            detailUrl: prefix + "/detail/{id}",
            modalName: "新增退牧还草工程进度",
            striped: true,
            bordered: true,
            pagination: false,
            showSearch: false,
            showToggle: false,
            // showColumns: false,
            showFooter: true,
            columns: [
                {
                    field: 'index',
                    title: '序号',
                    align: 'center',
                    valign: 'middle',
                    formatter: function (value, row, index) {
                        return index + 1;
                    },
                    footerFormatter: function (value) {
                        return '合计';
                    }
                },
                {
                    field: 'address',
                    title: '上报地区',
                    align: 'center',
                    valign: 'middle',
                },
                {
                    title: '任务年份',
                    field: 'year',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    field: 'wlmjCount',
                    title: '围栏规模合计(万亩)',
                    align: 'center',
                    valign: 'middle',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].wlmjCount);
                        }
                        $('#wlmjCount').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {

                    field: 'qtmjCount',
                    title: '其他规模合计(万亩)',
                    align: 'center',
                    valign: 'middle',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].qtmjCount);
                        }
                        $('#qtmjCount').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'zgmCount',
                    title: '总规模(万亩)',
                    align: 'center',
                    valign: 'middle',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].zgmCount);
                        }
                        $('#zgmCount').val(sumBalance.toFixed(2));
                        zgmCountSum = sumBalance.toFixed(2);
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'province',
                    footerFormatter: function (value) {
                        for (var i in value) {
                            $('#province').val(value[i].province);
                        }

                    }
                },
                {
                    field: 'city',
                    footerFormatter: function (value) {
                        for (var i in value) {
                            $('#city').val(value[i].city);
                        }

                    }
                },
                {
                    field: 'resolveId',
                    footerFormatter: function (value) {
                        for (var i in value) {
                            $('#resolveId').val(value[i].resolveId);
                        }

                    }
                },
                {
                    field: 'wlScale',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].wlScale);
                        }
                        $('#wlScale').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'wlInvestment',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].wlInvestment);
                        }
                        $('#wlInvestment').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'jmSize',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].jmSize);
                        }
                        $('#jmSize').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'jmMoney',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].jmMoney);
                        }
                        $('#jmMoney').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'xmSize',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].xmSize);
                        }
                        $('#xmSize').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'xmMoney',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].xmMoney);
                        }
                        $('#xmMoney').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'hqlxSize',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].hqlxSize);
                        }
                        $('#hqlxSize').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'hqlxMoney',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].hqlxMoney);
                        }
                        $('#hqlxMoney').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'smhzlSize',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].smhzlSize);
                        }
                        $('#smhzlSize').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'smhzlMoney',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].smhzlMoney);
                        }
                        $('#smhzlMoney').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'thcyglSize',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].thcyglSize);
                        }
                        $('#thcyglSize').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'thcyglMoney',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].thcyglMoney);
                        }
                        $('#thcyglMoney').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'rgscdSize',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].rgscdSize);
                        }
                        $('#rgscdSize').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'rgscdMoney',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].rgscdMoney);
                        }
                        $('#rgscdMoney').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'hspjSize',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].hspjSize);
                        }
                        $('#hspjSize').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'hspjMoney',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].hspjMoney);
                        }
                        $('#hspjMoney').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'httSize',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].httSize);
                        }
                        $('#httSize').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'httMoney',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].httMoney);
                        }
                        $('#httMoney').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'dhcSize',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].dhcSize);
                        }
                        $('#dhcSize').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'dhcMoney',
                    footerFormatter: function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].dhcMoney);
                        }
                        $('#dhcMoney').val(sumBalance.toFixed(2));
                        return sumBalance.toFixed(2);
                    }
                },
                {
                    field: 'totalScale',
                    formatter: function (value, row, index) {
                        totalScale = value;
                    }
                },
                {
                    title: '上报时间',
                    field: 'updateTime',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '操作',
                    align: 'center',
                    valign: 'middle',
                    formatter: function (value, row, index) {
                        var actions = [];
                        actions.push('<a class="Change state btn btn-primary btn-xs" onclick="$.operate.detailful(\'' + row.reportId + '\')"><i class="fa fa-edit"></i>查看</a> ');
                        return actions.join('');
                    }
                },
            ],
            onLoadSuccess: function () {
                $('#bootstrap-table').bootstrapTable('hideColumn', 'resolveId');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'province');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'city');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'wlScale');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'wlInvestment');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'jmSize');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'jmMoney');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'xmSize');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'xmMoney');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'hqlxSize');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'hqlxMoney');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'smhzlSize');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'smhzlMoney');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'thcyglSize');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'thcyglMoney');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'rgscdSize');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'rgscdMoney');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'hspjSize');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'hspjMoney');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'httSize');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'httMoney');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'dhcSize');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'dhcMoney');
                $('#bootstrap-table').bootstrapTable('hideColumn', 'totalScale');
                console.log("totalScale:"+totalScale);
                console.log("zgmCountSum:"+zgmCountSum);
                if(totalScale != 0){
                    let percentage = zgmCountSum/totalScale;
                    percentage = percentage * 100;
                    percentage = percentage.toFixed(0);
                    $("#progress").html(percentage+"%");
                    $("#progressBar").css("width",percentage+"%");
                }
            },
        };
        $.table.init(options);
    });


    layui.use('laydate', function () {
        var laydate = layui.laydate;

        //执行一个laydate实例
        laydate.render({
            elem: '#concreteTime'
            , type: 'year'
        });
    });
    $("#form-report-add").validate({
        focusCleanup: true
    });

    function submitHandler() {
        var year = $('#test2').val();
        if (year == '') {
            $.modal.confirm("年份未填写,请填写后提交？", function () {
            })
        } else {
            let gis_id = sessionStorage.getItem("gis_id");
            $("#mapId").val(gis_id);
            if ($.validate.form()) {
                $.operate.save(prefix + "/cityAdd", $('#form-report-add').serialize());
                sessionStorage.setItem("gis_id", "");
            }
        }
    }

    $("#month_concreteTime").datetimepicker({
        format: "mm",
        minView: "month",
        autoclose: true
    });
    $("#year_concreteTime").datetimepicker({
        format: "yyyy",
        minView: "month",
        autoclose: true
    });

    $("input[name='auditTime']").datetimepicker({
        format: "yyyy-mm-dd",
        minView: "month",
        autoclose: true
    });

    function timeType(type) {
        $('#yearType').hide();
        $('#month').hide();
        $('#season').hide();
        $("input[name='concreteTime']").val();
        $("select[name='concreteTime']").val();

        if ("年" == type) {
            $('#yearType').show();
        } else if ("月" == type) {
            $('#month').show();
        } else if ("季度" == type) {
            $('#season').show();
        }
    }

    /*绘图弹框*/
    function ht() {
        var id = $("#resolveId").val();
        var prefix = ctx + "system/gisMap";
        var url = prefix + '/getGisMap/' + 0;
        $.modal.open("新建绘图", url, '880', '650');

    }

    layui.use('laydate', function () {
        var laydate = layui.laydate;
        //执行一个laydate实例
        laydate.render({
            elem: '#test2',
            type: 'year',
        });
    });
</script>
</body>
</html>