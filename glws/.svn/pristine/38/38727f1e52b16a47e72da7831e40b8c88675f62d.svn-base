<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro" >
<head>
    <th:block th:include="include :: header('新增草原虫害发生与防治情况添加页面')"/>
    <th:block th:include="include :: datetimepicker-css"/>
</head>


<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-chfz-add">
        <h2 class="col-sm-12" style="text-align: center;font-weight: bold ">
            虫害发生与防治信息
        </h2>
        <h4 class="form-header h4">基本信息</h4>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">编号：</label>
                    <div class="col-sm-8">
                        <input name="number" class="form-control" onkeyup="value=value.replace(/[^\d^\.]+/g,'')" type="text" required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group" style="margin-top: 10px ">
                    <label class="col-sm-3 control-label">年度：</label>
                    <div class="input-group date">
                        <div class="col-sm-8">
                            <input name="year" class="form-control" placeholder="yyyy" type="text"
                                   style="display:block;float:left;width:421.33px " required>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">年-周：</label>
                    <div class="col-sm-8">
                        <input name="week" id="week" class="form-control" placeholder="---年第--周---"   type="text" required>
                        <input name="weekOld" id="weekOld" class="form-control"  style="background-color:transparent;margin-top: -34px;" onchange="getWeek(this.value)"  type="text" >
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">省级名称：</label>
                    <div class="col-sm-8">
                        <select id="addrProvince" style="width: 420px;height: 34px;border:1px solid #e5e6e7"
                                name="province" onchange="getCities()" required="required">
                            <option value="">----- 所在省 -------</option>
                        </select>
                    </div>
                </div>
            </div>

        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">市：</label>
                    <div class="col-sm-8">
                        <select
                                id="addrCity" name="city" style="width: 420px;height: 34px;border:1px solid #e5e6e7"
                                onchange="getAreas()" required="required"></select></div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">县：</label>
                    <div class="col-sm-8">
                        <select id="addrArea" name="county" style="width: 420px;height: 34px;border:1px solid #e5e6e7"
                                onchange="getlngLat()" required="required">
                        </select></div>
                </div>

            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">危害总面积：</label>
                    <div class="col-sm-8">
                        <input name="harmTotalarea" id="harmTotalarea" class="form-control" type="text" onchange="sum()" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">工程区危害面积：</label>
                    <div class="col-sm-8">
                        <input name="engineeringhazard" id="engineeringhazard" class="form-control" type="text" onchange="sum()" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">严重危害总面积：</label>
                    <div class="col-sm-8">
                        <input name="seriousArea" id="seriousArea" class="form-control" type="text" onchange="sum()" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">工程区严重危害面积：</label>
                    <div class="col-sm-8">
                        <input name="engineeringSeriousArea" id="engineeringSeriousArea" class="form-control" type="text" onchange="sum()" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">合计：</label>
                    <div class="col-sm-8">
                        <input name="totalPrevention" id="totalPrevention" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">化学防治：</label>
                    <div class="col-sm-8">
                        <input name="chemistryControl" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">小计：</label>
                    <div class="col-sm-8">
                        <input name="subtotal" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">招募椋鸟：</label>
                    <div class="col-sm-8">
                        <input name="attractStarlings" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">牧鸡：</label>
                    <div class="col-sm-8">
                        <input name="pastureChicken" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">牧鸭：</label>
                    <div class="col-sm-8">
                        <input name="pastureDuck" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">苦参碱：</label>
                    <div class="col-sm-8">
                        <input name="matrine" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">烟碱：</label>
                    <div class="col-sm-8">
                        <input name="nicotine" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">绿僵菌：</label>
                    <div class="col-sm-8">
                        <input name="greenMuscardineFungus" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">印楝素：</label>
                    <div class="col-sm-8">
                        <input name="azadirachtin" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">阿维菌素：</label>
                    <div class="col-sm-8">
                        <input name="avermectin" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">短稳杆菌：</label>
                    <div class="col-sm-8">
                        <input name="empedobacterBrevis" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">蛇床子素：</label>
                    <div class="col-sm-8">
                        <input name="osthole" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">阿维苏：</label>
                    <div class="col-sm-8">
                        <input name="weiSu" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">微孢子虫：</label>
                    <div class="col-sm-8">
                        <input name="enterocytozoonBieneusi" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">管理技术干部（人/天）：</label>
                    <div class="col-sm-8">
                        <input name="expatriateManagers" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">出工（人/天）：</label>
                    <div class="col-sm-8">
                        <input name="work" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">飞机（架/次）：</label>
                    <div class="col-sm-8">
                        <input name="plane" class="form-control" type="text"onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">大型喷雾器（台/套/天）：</label>
                    <div class="col-sm-8">
                        <input name="bigSprayer" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">中小型喷雾器（台/套/天）：</label>
                    <div class="col-sm-8">
                        <input name="smallSprayer" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">车辆（辆/天）：</label>
                    <div class="col-sm-8">
                        <input name="car" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">牧鸡（万只）：</label>
                    <div class="col-sm-8">
                        <input name="pastureChickenNum" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">牧鸭（万只）：</label>
                    <div class="col-sm-8">
                        <input name="pastureDuckNum" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">椋鸟巢（立方米）：</label>
                    <div class="col-sm-8">
                        <input name="starlingNest" class="form-control" type="text" onkeyup="value=value.replace(/[^\d^\.]+/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">备注：</label>
                    <div class="col-sm-8">
                        <input name="remarks" class="form-control" type="text">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <label class="col-sm-3 control-label">创建人：</label>
                <div class="col-sm-8">
                    <input name="createBy" class="form-control" type="text">
                </div>
            </div>
        </div>
    </form>
</div>
<div class="button-d" style="margin-left: 70%">
    <button type="button" class="btn btn-w-m btn-primary" onclick="saveup()">提 交</button>
    <button type="button" class="btn btn-w-m btn-primary" onclick="save()">保 存</button>
    <button type="button" class="btn btn-w-m btn-danger" onclick="closeItem()">关 闭</button>
</div>
</div>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: datetimepicker-js"/>
<script type="text/javascript">
    var prefix = ctx + "caiji/chfz";
    $("#form-chfz-add").validate({
        focusCleanup: true
    });

    function save() {
        if ($.validate.form()) {
            $.modal.confirm("确认要点击确定吗?", function () {
                saveTab(prefix + "/add", $('#form-chfz-add').serialize());
            });
        }
    }

    //求出合计
    function sum() {
        var harmTotalarea = $("#harmTotalarea").val();
        var engineeringhazard = $("#engineeringhazard").val();
        var seriousArea = $("#seriousArea").val();
        var engineeringSeriousArea = $("#engineeringSeriousArea").val();

        //判断不为空
        if (harmTotalarea == '' && harmTotalarea == 0) {
            var harmTotalarea = 0;
        }
        if (engineeringhazard == '' && engineeringhazard == 0) {
            var engineeringhazard = 0;
        }
        if (seriousArea == '' && seriousArea == 0) {
            var seriousArea = 0;
        }
        if (engineeringSeriousArea == '' && engineeringSeriousArea == 0) {
            var engineeringSeriousArea = 0;
        }
        totalPrevention.value = (parseFloat(harmTotalarea) + parseFloat(engineeringhazard) + parseFloat(seriousArea) + parseFloat(engineeringSeriousArea)).toFixed(2);
    }

    function getWeek(dateString){
        var date = new Date(dateString)
        var newDate=new Date(date.getFullYear(), 0, 1);
        var day=date.getDay();
        var year = date.getFullYear();
        if(day==0) day=7;
        var newday=newDate.getDay();
        if(newday==0) newday=7;
        d = Math.round((date.getTime() - newDate.getTime()+(newday-day)*(24*60*60*1000)) / 86400000);
        var week = Math.ceil(d /7)+1;
        document.getElementById("week").value = year+"-"+week;
        $("#weekOld").val("");
    }
    $("input[name='weekOld']").datetimepicker({
        format: "yyyy-mm-dd",
        minView: "month",
        autoclose: true
    });
    function saveTab(url, data, callback) {
        var config = {
            url: url,
            type: "post",
            dataType: "json",
            data: data,
            beforeSend: function () {
                $.modal.loading("正在处理中，请稍后...");
            },
            success: function (result) {
                if (typeof callback == "function") {
                    callback(result);
                }
                if (result.code == web_status.SUCCESS) {
                    confirmdemo(result.msg, function () {
                        reload();
                    });
                } else if (result.code == web_status.WARNING) {
                    $.modal.alertWarning(result.msg)
                } else {
                    $.modal.alertError(result.msg);
                }
                $.modal.closeLoading();
            }
        };
        $.ajax(config)
    }

    function saveup() {
        if ($.validate.form()) {
            $.modal.confirm("确认要点击确定吗?", function () {
                saveModal(prefix + "/add1", $('#form-chfz-add').serialize());
            });
        }
    }

    $("input[name='year']").datetimepicker({
        format: "yyyy",
        startView: 4,
        minView: 4,
        maxView: 4,
        autoclose: true
    });

    function confirmdemo(content, callBack) {
        layer.confirm(content, {
            icon: 3,
            title: "系统提示",
            btn: ['确认']
        }, function (index) {
            layer.close(index);

            callBack(true);

        });
    };

    // 保存信息 弹出提示框
    function saveModal(url, data, callback) {
        var config = {
            url: url,
            type: "post",
            dataType: "json",
            data: data,
            success: function (result) {
                if (typeof callback == "function") {
                    callback(result);
                }
                if (result.code == web_status.SUCCESS) {
                    confirmdemo(result.msg, function () {
                        reload();
                    });
                } else if (result.code == web_status.WARNING) {
                    $.modal.alertWarning(result.msg)
                } else {
                    $.modal.alertError(result.msg);
                }
                $.modal.closeLoading();

            }
        };
        $.ajax(config)
    }

    function reload() {
        parent.location.reload();
    }


    //省市区三级联动
    $(function () {
        getProvinces();
    });

    function getProvinces() {
        //  var url = "<%=basePath%>dict/getProvinces";
        var url = ctx + "caiji/survey/getProvinces";
        $.ajax({
            "url": url,
            "type": "GET",
            "dataType": "json",
            "success": function (data) {
                for (var i = 0; i < data.length; i++) {
                    var op = document.createElement("option");
                    op.value = data[i].dictCode;
                    op.text = data[i].dictLabel;
                    document.getElementById("addrProvince").appendChild(op);
                }
            }
        });
    }

    // ===== 加载市列表 =====
    function getCities() {
        $("#addrCity").empty();
        $("#addrArea").empty();
        var url = ctx + "caiji/survey/getCities";
        var data = "provinceCode=" + $("#addrProvince").val();
        $.ajax({
            "url": url,
            "data": data,
            "type": "GET",
            "dataType": "json",
            "success": function (data) {
                var op = document.createElement("option");
                op.value = "";
                op.text = "----- 所在市 -------";
                document.getElementById("addrCity").appendChild(op);
                for (var i = 0; i < data.length; i++) {
                    var op = document.createElement("option");
                    op.value = data[i].dictCode;
                    op.text = data[i].dictLabel;
                    document.getElementById("addrCity").appendChild(op);
                }
            }
        });
    }

    // ===== 加载区列表 =====
    function getAreas() {
        $("#addrArea").empty();
        $("#addrdz").empty();
        //var url = "<%=basePath%>dict/getAreas";
        var url = ctx + "caiji/survey/getAreas";
        var data = "cityCode=" + $("#addrCity").val();
        $.ajax({
            "url": url,
            "data": data,
            "type": "GET",
            "dataType": "json",
            "success": function (data) {
                var op = document.createElement("option");
                op.value = "";
                op.text = "----- 所在区 -------";
                document.getElementById("addrArea").appendChild(op);
                for (var i = 0; i < data.length; i++) {
                    var op = document.createElement("option");
                    op.value = data[i].dictCode;
                    op.text = data[i].dictLabel;
                    document.getElementById("addrArea").appendChild(op);
                }
            }
        });

    }

</script>
</body>
</html>