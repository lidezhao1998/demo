<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sinosoft.extinterface.mapper.LandSurveyMapper">

    <resultMap type="com.sinosoft.extinterface.domain.LandSurvey" id="LandSurveyResult">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="status" column="status"/>
        <result property="item" column="item"/>
        <result property="itemCode" column="item_code"/>
        <result property="generic" column="generic"/>
        <result property="genericCode" column="generic_code"/>
        <result property="sectionCode" column="section_code"/>
        <result property="section" column="section"/>
        <result property="status" column="status"/>
        <result property="bundle" column="bundle"/>
        <result property="bundleCode" column="bundle_code"/>
        <result property="provinceName" column="province_name"/>
        <result property="geomData" column="geom_data"/>
        <result property="centroid" column="centroid"/>
        <result property="createBy" column="create_by"/>
        <result property="createTime" column="create_time"/>
        <result property="updateBy" column="update_by"/>
        <result property="updateTime" column="update_time"/>
        <result property="province" column="province"/>
        <result property="city" column="city"/>
        <result property="county" column="county"/>
        <result property="ownershipProperty" column="ownership_property"/>
        <result property="landType" column="land_type"/>
        <result property="grasslandType" column="grassland_type"/>
        <result property="remark" column="remark"/>
    </resultMap>

    <sql id="selectLandSurveyVo">
        select d.id,
               d.name,
               d.status
        from a_landsurvey_interface d
    </sql>
    <insert id="insertlandSurvey" parameterType="com.sinosoft.extinterface.domain.LandSurvey">
        insert into land_space(
        geom_data,
        item_code,
        item,
        section_code,
        section,
        generic_code,
        generic,
        bundle_code,
        bundle,
        status,
        color,
        province_name,
        year,
        area
        )values
        <foreach collection="list" item="item" index="index" separator="," >
            (
            st_geomfromtext(#{item.geomData}),
            #{item.itemCode},
            #{item.item},
            #{item.sectionCode},
            #{item.section},
            #{item.genericCode},
            #{item.generic},
            #{item.bundleCode},
            #{item.bundle},
            #{item.status},
            #{item.color},
            #{item.provinceName},
            to_char(current_date,'yyyy'),
            #{item.area}
            )
        </foreach>
    </insert>

    <!--列表-->
     <select id="selectLandSurveyList" parameterType="com.sinosoft.extinterface.domain.LandSurvey" resultMap="LandSurveyResult">
        select
        id,
        item_code,
        item,
        section_code,
        section,
        generic_code,
        generic,
        bundle_code,
        bundle,
        status,
        color,
        province_name,
        province,
        city,
        county,
        ownership_property,
        land_type,
        grassland_type,
        remark,
        st_astext(ST_Centroid(geom_data)) geom_data,
        st_area(geography(geom_data))  area
        from land_space
        where
        def_falg=0
        <if test="item != null and item != ''">
            AND item like concat('%', #{item}, '%')
        </if>
      <if test="section != null and section != ''">
            AND section like concat('%', #{section}, '%')
        </if>
      <if test="generic != null and generic != ''">
            AND generic like concat('%', #{generic}, '%')
        </if>
      <if test="bundle != null and bundle != ''">
            AND bundle like concat('%', #{bundle}, '%')
        </if>
       <if test="provinceCode != null and provinceCode != ''">
           AND province_code =#{provinceCode}
       </if>
       <if test="cityCode != null and cityCode != ''">
           AND city_code =#{cityCode}
       </if>
       <if test="countyCode != null and countyCode != ''">
            AND county_code =#{countyCode}
        </if>
       <if test="grasslandType != null and grasslandType != ''">
            AND grassland_type =#{grasslandType}
        </if>
         <if test="status != null and  status.toString() !='-1'">
             AND  status =#{status}
         </if>
         order by id
    </select>




    <select id="selectLandSurveyById" parameterType="Long" resultMap="LandSurveyResult">
        select id,
               parent_id parentId,
               ancestors,
               name,
               status
        from a_landsurvey_interface
        where id = #{id}
    </select>
    <!--编辑-->
    <select id="selectLandSurvey" resultType="com.sinosoft.extinterface.domain.LandSurvey">
        select
        id,
        item_code itemCode,
        item,
        section_code sectionCode,
        section,
        generic_code genericCode,
        generic,
        bundle_code bundleCode,
        province,
        city,
        county,
        bundle,
        status,
        color,
        grassland_type  grasslandType,
        ownership_property ownershipProperty,
        CONCAT( province,city,county)  provinceName,
        st_area(geography(geom_data))  area
        from land_space
        where id = #{id}
    </select>
    <select id="getProvincesCode" resultType="java.lang.String">
      SELECT  dict_code from sys_dict_data where  dict_label=#{provinces}
    </select>
    <select id="getCityCode" resultType="java.lang.String">
   SELECT  dict_code from sys_dict_data where  dict_label=#{city} and dict_parent=#{provincesCode}

    </select>

    <!--审核通过-->
    <update id="examineSpatialPlanning" parameterType="Long">
       update land_space set status =1 where id=#{id}

    </update>
    <!--审核取消-->
    <update id="unExamineSpatialPlanning" parameterType="Long">
       update land_space set status =0 where id=#{id}

    </update>
    <!--逻辑删除-->
    <update id="defFalgSpatialPlanning" parameterType="Long">
       update land_space set def_falg ='1' where id=#{id}
    </update>
    <update id="updateaddFields" parameterType="com.sinosoft.extinterface.domain.LandSurvey">
      update land_space
        <set>
            <if test="province!=null and province!=''">
                province =#{province},
            </if>
            <if test="city!=null and city!=''">
                city =#{city},
            </if>
            <if test="county!=null and county!=''">
                county =#{county},
            </if>
           <if test="provinceCode!=null and provinceCode!=''">
                province_code =#{provinceCode},
            </if>
            <if test="cityCode!=null and cityCode!=''">
                city_code =#{cityCode},
            </if>
            <if test="countyCode!=null and countyCode!=''">
                county_code =#{countyCode},
            </if>
            <if test="ownershipProperty!=null and ownershipProperty!=''">
                ownership_property =#{ownershipProperty},
            </if>
            <if test="landType!=null and landType!=''">
                land_type =#{landType},
            </if>
            <if test="grasslandType!=null and grasslandType!=''">
                grassland_type =#{grasslandType},
            </if>

        </set>



      where id=#{id}
    </update>
    <update id="updateLandSurvey" parameterType="com.sinosoft.extinterface.domain.LandSurvey">
       update land_space
        <set>
            <if test="province!=null and province!=''">
                province =#{province},
            </if>
            <if test="city!=null and city!=''">
                city =#{city},
            </if>
            <if test="county!=null and county!=''">
                county =#{county},
            </if>
            <if test="provinceCode!=null and provinceCode!=''">
                province_code =#{provinceCode},
            </if>
            <if test="cityCode!=null and cityCode!=''">
                city_code =#{cityCode},
            </if>
            <if test="countyCode!=null and countyCode!=''">
                county_code =#{countyCode},
            </if>
            <if test="ownershipProperty!=null and ownershipProperty!=''">
                ownership_property =#{ownershipProperty},
            </if>
            <if test="landType!=null and landType!=''">
                land_type =#{landType},
            </if>
            <if test="grasslandType!=null and grasslandType!=''">
                grassland_type =#{grasslandType},
            </if>
            area =#{area},
             province_name=#{provinceName}
        </set>


        where id=#{id}


    </update>

</mapper> 