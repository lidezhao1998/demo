<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('修改【毒害草知识库信息')"/>
    <th:block th:include="include :: jasny-bootstrap-css"/>
</head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-knowledge-edit" th:object="${cPoisonKnowledge}">
        <input name="id" th:field="*{id}" type="hidden">

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">中文名：</label>
                    <div class="col-sm-8">
                        <input name="chineseName" th:field="*{chineseName}" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">

                <div class="form-group">
                    <label class="col-sm-3 control-label">学名：</label>
                    <div class="col-sm-8">
                        <input name="scientificName" th:field="*{scientificName}" class="form-control" type="text">
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">别名：</label>
                    <div class="col-sm-8">
                        <input name="alias" th:field="*{alias}" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">

                <div class="form-group">
                    <label class="col-sm-3 control-label">俗名：</label>
                    <div class="col-sm-8">
                        <input name="commonName" th:field="*{commonName}" class="form-control" type="text">
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">科_亚科：</label>
                    <div class="col-sm-8">
                        <input name="divisionSubfamily" th:field="*{divisionSubfamily}" class="form-control"
                               type="text">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">

                <div class="form-group">
                    <label class="col-sm-3 control-label">属_亚属：</label>
                    <div class="col-sm-8">
                        <input name="genusSubgenus" th:field="*{genusSubgenus}" class="form-control" type="text">
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">形态特征：</label>
                    <div class="col-sm-8">
                        <input name="morphologicalCharacter" th:field="*{morphologicalCharacter}" class="form-control"
                               type="text">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">防治方法：</label>
                    <div class="col-sm-8">
                        <input name="controlMethods" th:field="*{controlMethods}" class="form-control" type="text">
                    </div>
                </div>
            </div>

        </div>

        <div class="row">
            <div class="col-sm-6">

                <div class="form-group">
                    <label class="col-sm-3 control-label">诊断：</label>
                    <div class="col-sm-8">
                        <input name="diagnosis" th:field="*{diagnosis}" class="form-control" type="text">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">

                <div class="form-group">
                    <label class="col-sm-3 control-label">分布_国内：</label>
                    <div class="col-sm-8">
                        <input name="distributionDomestic" th:field="*{distributionDomestic}" class="form-control"
                               type="text">
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">分布_国外：</label>
                    <div class="col-sm-8">
                        <input name="distributionAbroad" th:field="*{distributionAbroad}" class="form-control"
                               type="text">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">

                <div class="form-group">
                    <label class="col-sm-3 control-label">生境：</label>
                    <div class="col-sm-8">
                        <input name="habitat" th:field="*{habitat}" class="form-control" type="text">
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">中毒症状：</label>
                    <div class="col-sm-8">
                        <input name="poisoningSymptoms" th:field="*{poisoningSymptoms}" class="form-control"
                               type="text">
                    </div>
                </div>
            </div>

            <div class="col-sm-6">

                <div class="form-group">
                    <label class="col-sm-3 control-label">有毒部位：</label>
                    <div class="col-sm-8">
                        <input name="toxicParts" th:field="*{toxicParts}" class="form-control" type="text">
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">有毒成分：</label>
                    <div class="col-sm-8">
                        <input name="toxicIngredients" th:field="*{toxicIngredients}" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">

                <div class="form-group">
                    <label class="col-sm-3 control-label">危害动物：</label>
                    <div class="col-sm-8">
                        <input name="harmfulAnimals" th:field="*{harmfulAnimals}" class="form-control" type="text">
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label">危害：</label>
                    <div class="col-sm-8">
                        <input name="harm" th:field="*{harm}" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">

                <div class="form-group">
                    <label class="col-sm-3 control-label">中毒机理：</label>
                    <div class="col-sm-8">
                        <input name="poisoningMechanism" th:field="*{poisoningMechanism}" class="form-control"
                               type="text">
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">生态图：</label>
                    <div class="fileinput fileinput-new" data-provides="fileinput">
                        <input id="delespan2" name="ecologicalMapName" th:field="*{ecologicalMapName}" type="hidden">
                        <div class="fileinput-new thumbnail" style="width: 120px; height: 80px;">
                            <img id="test2"
                                 th:src="(${cPoisonKnowledge.ecologicalMapName} == '') ? null : @{${cPoisonKnowledge.ecologicalMapName}}">
                        </div>
                        <a href="#" onclick="delespan2()">删除</a>
                        <div class="fileinput-preview fileinput-exists thumbnail"
                             style="max-width: 200px; max-height: 150px;"></div>
                        <div>
                            <span class="btn btn-white btn-file"><span class="fileinput-new">选择图片</span><span
                                    class="fileinput-exists">更改</span><input type="file" class="" name="file2"
                                                                             id="ecologicalMapName"
                                                                             accept="image/*"/></span>
                            <a href="#" class="btn btn-white fileinput-exists" data-dismiss="fileinput">清除</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">分布图：</label>
                    <div class="fileinput fileinput-new" data-provides="fileinput">
                        <input id="delespan3" name="distributionmapName" th:field="*{distributionmapName}"
                               type="hidden">
                        <div class="fileinput-new thumbnail" style="width: 120px; height: 80px;">
                            <img id="test3"
                                 th:src="(${cPoisonKnowledge.distributionmapName} == '') ? null : @{${cPoisonKnowledge.distributionmapName}}">
                        </div>
                        <a href="#" onclick="delespan3()">删除</a>
                        <div class="fileinput-preview fileinput-exists thumbnail"
                             style="max-width: 200px; max-height: 150px;"></div>
                        <div>
                            <span class="btn btn-white btn-file"><span class="fileinput-new">选择图片</span><span
                                    class="fileinput-exists">更改</span><input type="file" class="" name="file3"
                                                                             id="distributionmapName" accept="image/*"/></span>
                            <a href="#" class="btn btn-white fileinput-exists" data-dismiss="fileinput">清除</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">形态图：</label>
                    <div class="fileinput fileinput-new" data-provides="fileinput">
                        <input id="delespan" name="morphologyName" th:field="*{morphologyName}" type="hidden">
                        <div class="fileinput-new thumbnail" style="width: 120px; height: 80px;">
                            <img id="test"
                                 th:src="(${cPoisonKnowledge.morphologyName} == '') ? null : @{${cPoisonKnowledge.morphologyName}}">
                        </div>
                        <a href="#" onclick="delespan()">删除</a>
                        <div class="fileinput-preview fileinput-exists thumbnail"
                             style="max-width: 200px; max-height: 150px;"></div>
                        <div>
                            <span class="btn btn-white btn-file"><span class="fileinput-new">选择图片</span><span
                                    class="fileinput-exists">更改</span><input type="file" class="" name="file"
                                                                             id="morphologyName"
                                                                             accept="image/*"/></span>
                            <a href="#" class="btn btn-white fileinput-exists" data-dismiss="fileinput">清除</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div class="col-sm-offset-5 col-sm-10">
        <button type="button" class="btn btn-sm btn-primary" th:onclick="submitHandler()"><i class="fa fa-check"></i>保 存
        </button>&nbsp;
        <button type="button" class="btn btn-sm btn-danger" onclick="closeItem()"><i class="fa fa-reply-all"></i>关 闭
        </button>

    </div>
</div>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: jasny-bootstrap-js"/>
<script type="text/javascript">
    var prefix = ctx + "library/poisonknowledge";
    $("#form-knowledge-edit").validate({
        focusCleanup: true
    });

    function submitHandler() {
        if ($.validate.form()) {
            $.operate.save(prefix + "/edit", $('#form-knowledge-edit').serialize());
            uploadFile();
        }
    }

    //图片上传功能
    function uploadFile() {
        var url = ctx + "library/poisonknowledge/edit";

        var formData = new FormData(document.getElementById("form-knowledge-edit"));

        if ($("#test").val() == null) {
            formData.append('file', "1");

        } else {
            formData.append('file', $("#morphologyName")[0].files[0]);
        }
        if ($('#test2').val() == null) {

        } else {
            formData.append('file2', $("#ecologicalMapName")[0].files[0]);
        }
        if ($('#test3').val() == null) {

        } else {
            formData.append('file3', $("#distributionmapName")[0].files[0]);

        }
        $.ajax({
            url: url,
            type: 'post',
            cache: false,
            data: formData,
            contentType: false,
            processData: false,
            success: function (result) {
                $.operate.successCallback(result);
            }
        });
    }


    //本地上传的图片删除，去掉图片的id即可
    function delespan() {
        var id = $("#id").val();
        var type = "morphologyName";

        var url = ctx + "library/poisonknowledge/delPothon";
        $.ajax({
            url: url,
            type: 'post',
            cache: false,
            dataType: 'json',
            data: {id: id, type: type},
            success: function (obj) {
                if (obj == '200') {
                    $('#test').remove();
                    $("#delespan").val(null);
                } else {
                    alert("删除失败");
                    return false;
                }
            }
        });
    }

    function delespan2() {
        var id = $("#id").val();
        var type = "ecologicalMapName";

        var url = ctx + "library/poisonknowledge/delPothon";
        $.ajax({
            url: url,
            type: 'post',
            cache: false,
            dataType: 'json',
            data: {id: id, type: type},
            success: function (obj) {
                if (obj == '200') {
                    $('#test2').remove();
                    $("#delespan2").val(null);

                } else {
                    alert("删除失败");
                    return false;
                }
            }
        });
    }

    function delespan3() {
        var type = "distributionmapName";

        var id = $("#id").val();
        var url = ctx + "library/poisonknowledge/delPothon";
        $.ajax({
            url: url,
            type: 'post',
            cache: false,
            dataType: 'json',
            data: {id: id, type: type},
            success: function (obj) {
                if (obj == '200') {
                    $('#test3').remove();
                    $("#delespan3").val(null);

                } else {
                    alert("删除失败");
                    return false;
                }
            }
        });
    }

</script>
</body>
</html>