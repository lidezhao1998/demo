<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <th:block th:include="include :: header('国家土地调查数据')"/>
    <link th:href="@{/css/gis.css}" rel="stylesheet"/>

</head>
<body onload="onLoad()">
<div class="container-div">
    <div class="row">
    <div id="map">
        <div class="header-r">
            <div class="header-r-bg">
                <strong></strong><a href="javascript:;" style="font-size: 16px;color:red" id="gisZoom"></a></strong>
                <a href="javascript:;" id="comparison" onclick="comparison()">比对</a>
                <a href="javascript:;" id="ranging" onclick="measurementGis('LineString')">测距</a>
                <a href="javascript:;" id="measuringSurface" onclick="measurementGis('Polygon')">测面</a>
                <a href="javascript:;" id="markPoint" onclick="drawGis('Point','tab')">标记点</a>
                <a href="javascript:;" id="markingSurface" onclick="drawGis('Polygon','tab')">标记面</a>
                <a href="javascript:;" id="markedList">标记列表</a>
                <a href="javascript:;" id="pointSerch" onclick="pointQuery()">点查</a>
                <a href="javascript:;" id="locationShow">定位</a>
                <a href="javascript:;" id="conditionQuery">条件查询</a>
                <div class="conditionQuery_sel" style="display: none">
                    <div class="triangle"></div>
                    <a href="javascript:;" id="business" onclick="">业务查询</a>
                    <a href="javascript:;" id="special">专题查询</a>
                </div>
            </div>
        </div>
        <div id="menu">
            <input type="button" id="off"/>
        </div>
        <div id="menu3">
            <input id="type3" value="全国" onclick="updateCity()"readonly>
        </div>
        <div class="layer_tree_show">
            <div class="layer_tree_show_map" style="width: 55px"></div>
        </div>
        <div class="layer_tree_hide">
            <i class="fa fa-chevron-left"></i>
        </div>
        <div class="west">
            <div class="box box-main">
                <div class="ui-layout-content" style="height: 420px">
                    <div id="businessLayer" class="ztree" style="overflow-x: scroll;height: 200px;"></div>
                    <div id="thematicLayer" class="ztree" style="overflow-x: scroll;height: 200px;"></div>
                </div>
            </div>
        </div>
        <div id="dist_positioning">
            <p id="title_zq"><span>地区定位</span> <span onclick="cityDivDoneById('dist_positioning')"
                                                     style="float: right;margin: 0 10px;cursor: pointer;">关闭</span>
            </p>
            <div id="zqdw"><p class="content_ul" style="color: #13c6ae;">全国</p></div>
            <ul class="zq_ul"></ul>
        </div>
        <div id="shpTitle" class="col-sm-12 select-table table-striped">
            <table id="bootstrap-table">
            </table>
        </div>
        <!--定位-->
        <div class="coordinatePositioning">
            <li class="clear li-dw selected" style="display: block;">
                <span class="zs-left icon icon-dw"></span>
                <div class="zs-left module" style="display: block;">

                    <div class="ori-module-content module-content" style="display: block;padding-left: 50px;">
                        <table class="jwd tabls" style="display: table;">
                                         <tr>
                                        <td class="text">经度：</td>
                                        <td class="input"><input id="decimalLon" value="" class="form-control sea-input" onkeyup="value=value.replace(/^\D*(\d*(?:\.\d{0,2})?).*$/g, '$1')" placeholder="例:11.1"></td>
                                    </tr>
                                    <tr>
                                        <td class="text">纬度：</td>
                                        <td class="input"><input id="decimalLat" value="" class="form-control sea-input" onkeyup="value=value.replace(/^\D*(\d*(?:\.\d{0,2})?).*$/g, '$1')" placeholder="例:23.1"></td>
                                    </tr>
                        </table>
                        <div class="dw-box" style="margin-top: 15px;">
                            <button type="button" class="btn btn-primary" id="positioning_btn">定位</button>
                            <button type="button" class="btn btn-danger" id="closePositioning">关闭</button>
                        </div>
                    </div>
                </div>
            </li>
            <div id="mouse-position">
            </div>
        </div>
    </div>
    <div id="map-left" style="display: none">
        <div class="layer_tree_show">
            <div class="layer_tree_show_map_left"></div>
        </div>
        <div class="layer_tree_hide_left">
            <i class="fa fa-chevron-left"></i>
        </div>
        <div class="west-left">
            <div class="box box-main">
                <div class="ui-layout-content" style="height: 420px">
                    <div id="businessLayer_left" class="ztree" style="overflow-x: scroll;height: 200px;"></div>
                    <div id="thematicLayer_left" class="ztree" style="overflow-x: scroll;height: 200px;"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="map-right" style="display: none">
        <div class="header-r">
            <div class="header-r-bg">
                <a href="javascript:;" id="gisQuit" onclick="gisQuit()">退出</a>
            </div>
        </div>
        <div class="layer_tree_show">
            <div class="layer_tree_show_map_right"></div>
        </div>
        <div class="layer_tree_hide_right">
            <i class="fa fa-chevron-left"></i>
        </div>
        <div class="west-right">
            <div class="box box-main">
                <div class="ui-layout-content" style="height: 420px">
                    <div id="businessLayer_right" class="ztree" style="overflow-x: scroll;height: 200px;"></div>
                    <div id="thematicLayer_right" class="ztree" style="overflow-x: scroll;height: 200px;"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-12">
        <div class="container-div">
            <div class="row">
                <div class="col-sm-12 search-collapse">
                    <form id="dept-form">
                        <div class="select-list">
                            <ul>
                                <li>
                                    目 ：<input type="text" name="item" style="width: 100px;"/>
                                </li>
                                <li>
                                    科 ：<input type="text" name="section" style="width: 100px;"/>
                                </li>
                                <li>
                                    属：<input type="text" name="generic" style="width: 100px;"/>
                                </li>
                                <li>
                                    从：<input type="text" name="bundle" style="width: 100px;"/>
                                </li>
                                <li>
                                    状态：
                                    <select name="status" id="status" style="width: 100px;">
                                        <option value="-1">所有</option>
                                        <option value="0">未审核</option>
                                        <option value="1">已审核</option>
                                    </select>
                                </li>
                                <li>
                                    <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search('dept-form','slsj')"><i class="fa fa-search"></i>&nbsp;搜索</a>
                                    <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset('dept-form','slsj')"><i class="fa fa-refresh"></i>&nbsp;重置</a>
                                </li>
                            </ul>
                        </div>
                    </form>
                </div>

                <div class="btn-group-sm" style="margin-top: -13px;margin-bottom: -10px;" id="shptoolbar" role="group">
<!--                    <a class="btn btn-success" style="margin-top: -8px;margin-bottom: -3px;" onclick="$.operate.add(100)" shiro:hasPermission="system:shpFile:add">
                        <i class="fa fa-upload"></i>导入
                    </a>-->
                    <!--<a class="btn btn-warning " onclick="auditAllshp()">-->
                    <!--<i class="fa fa-download"></i> 批量审核-->
                    <!--</a>-->
                </div>
                <div class="col-sm-12 select-table table-striped" style="overflow-x: scroll">
                    <table id="slsj" style="width: 2020px"></table>
                </div>
            </div>
        </div>
    </div>
    <div class="modal inmodal" id="myModal" align="center" tabindex="-1" role="dialog" aria-hidden="true">
        <img id="img" name="img">
    </div>
</body>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: ztree-js"/>
<th:block th:include="include :: ztree-css"/>
<script th:src="@{/js/gis/glmaGis.js}"></script>
<script th:src="@{/js/gis/gisComparison.js}"></script>
<script th:inline="javascript">
    var landsurveyPrefix = ctx + "extinterface/landsurvey";
    $(function () {
        var landsurveyoptions = {
            id: "slsj",
            toolbar: "shptoolbar",
            url: landsurveyPrefix+"/list",
            createUrl: landsurveyPrefix + "/add/{id}",
            updateUrl: landsurveyPrefix + "/edit/{id}",
            removeUrl: landsurveyPrefix + "/remove/{id}",
            detailUrl: landsurveyPrefix + "/detail/{id}",
            modalName: "shp文件",
            pageSize:2,
            pageList:[2,3,5,10,15,20,100],//分页步进值
            showSearch: false,
            showToggle: false,
            showColumns: false,
            showRefresh: false,
            columns: [{
                checkbox: true,
                formatter:  function (value, row, index) {
                    if (row.status == 1){
                        return {
                            disabled : true//设置是否可用
                        };
                    }
                }
            },
                {
                    field: 'id',
                    title: '图斑编码'
                },
                 {
                    field: 'item',
                    title: '目'
                },
                {
                    field: 'section',
                    title: '科'
                },
                {
                    field: 'generic',
                    title: '属'
                },
                {
                    field: 'bundle',
                    title: '丛'
                },
                {
                    field: 'province',
                    title: '省'
                },
                {
                    field: 'city',
                    title: '市'
                },
                {
                    field: 'county',
                    title: '县'
                },

                {
                    field: 'geomData',
                    title: '经度/纬度',
                    formatter: function (value, row, index) {
                        var newCentroid=  value.replace("POINT(","").replace(")","").replace(" "," / ");
                        return newCentroid;
                    }
                },
                {
                    field: 'area',
                    title: '图斑面积(平方米)'
                },
                {
                    field: 'patternSpotCharacteristic',
                    title: '图斑特征',
                    formatter: function (value, row, index) {

                        return "多边形";
                    }
                },
                {
                    field: 'landType',
                    title: '地类'
                },
                {
                    field: 'ownershipProperty',
                    title: '权属性质'
                },
               {
                    field: 'grasslandType',
                    title: '草地类型'
                },
                {
                    field: 'status',
                    title: '状态',
                    formatter: function (value, row, index) {
                        if(value==1){
                            return "已审核";
                        }else{
                            return "未审核";
                        }
                    }
                },
                {
                    title: '操作',
                    align: 'left',
                    formatter: function (value, row, index) {
                        if (row.parentId != 0) {
                            var actions = [];
                            actions.push('<a class="btn btn-info  btn-xs " href="javascript:void(0)" onclick="shpInfoLayer(' + row.id + ',\''+row.geomData+'\')"><i class="fa fa-search"></i>查看</a> ');
                            if(row.status!='1'){
                                // actions.push('<a class="btn btn-success btn-xs " href="javascript:void(0)" onclick="$.operate.edit(\'' + row.shpFileId + '\')"><i class="fa fa-edit"></i>编辑</a> ');
                                actions.push('<a class="btn btn-warning btn-xs" href="javascript:void(0)" onclick="examine(\'' + row.id + '\')"><i class="fa fa-adjust"></i>审核通过</a>');
                                actions.push('<a class="btn btn-success btn-xs " href="javascript:void(0)" onclick="$.operate.edit(\'' + row.id + '\')"><i class="fa fa-edit"></i>编辑</a> ');
                                actions.push('<a class="btn btn-danger btn-xs " href="javascript:void(0)" onclick="$.operate.remove(\'' + row.id + '\')"><i class="fa fa-trash"></i>删除</a>');
                            }else{
                                actions.push('<a class="btn btn-warning btn-xs" href="javascript:void(0)" onclick="unexamine(\'' + row.id + '\')"><i class="fa fa-blind"></i>驳回审核</a>');
                            }
                            return actions.join('');
                        } else {
                            return "";
                        }
                    }
                }]
        };
        $.table.init(landsurveyoptions);
    });
    function examine(id) {
        var data={"id":id}
        $.modal.confirm("确定审核通过吗？", function() {
            $.ajax({
                type: "post",
                url: landsurveyPrefix + "/examine",
                data: data,
                success: function (res) {
                    $.table.refresh();
                    $.operate.ajaxSuccess(res)
                }
            });
        })
    }
    function shpInfoLayer(id,geomData) {
        clearGis(map);
        var cql="id=" + id;
        var tiled = new ol.layer.Tile({
            source: new ol.source.TileWMS({
                url: gisUrl + urlLayer,
                params: {
                    FORMAT: 'image/png',
                    VERSION: '1.1.1',
                    tiled: true,
                    exceptions: 'application/vnd.ogc.se_inimage',
                    LAYERS:"gis:land_space",
                    CQL_FILTER: cql
                }
            })
        });
        map.addLayer(tiled);
        pointLocation(geomData);



    }

    function unexamine(id) {

        var data={"id":id}
        $.modal.confirm("确定取消审核吗？", function() {
            $.ajax({
                type: "post",
                async:false,
                url: landsurveyPrefix + "/unexamine",
                data: data,
                success: function (data) {
                    $.table.refresh();
                    $.operate.ajaxSuccess(res)
                }

            });
        })
    }

    function auditAllshp() {
        var ids=$("#slsj").bootstrapTable("getAllSelections")
        if (ids.length == 0) {
            $.modal.alertWarning("请至少选择一条记录");
            return;
        }
        $.modal.confirm("确定要审核通过" + ids.length + "条数据吗?", function() {
            var data="0";
            for(var i=0;i<ids.length;i++){
                data+=","+ids[i].id
            }
            $.operate.post(landsurveyPrefix + "/auditAllShp",{"ids":data});
        });
    }

    function show(fileName){
        zOnClick(fileName);
    }
    function onLoad() {
        load();
    }


</script>
</html>