<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>加载天地图</title>
    <th:block th:include="include :: header('地图')"/>
</head>
<!--<body onLoad="onLoad()">-->

    <!--<div class="col-sm-12 search-collapse" id="savaInput">-->
        <!--<input type="hidden" name="spotinfos" id="spotinfos" value="">&lt;!&ndash;保存坐标信息&ndash;&gt;-->
    <!--</div>-->
    <div  id="videoDiv" border="10px" style="width: 100%;height: 100%">
    </div>
    <div class="container-div">
        <div class="row">
            <div id="map">
                <div id="menu3">
                    <input id="type3" value="全国" onclick="updateCity()"readonly>
                </div>


                <div id="dist_positioning" style="left:20px;top: 35px">
                    <p id="title_zq"><span class="content_ul" style="color: #13c6ae;">全国</span> <span onclick="cityDivDoneById('dist_positioning')"
                                                             style="float: right;margin: 0 10px;cursor: pointer;">关闭</span>
                    </p>
                    <!--<div id="zqdw"><p class="content_ul" style="color: #13c6ae;">全国</p></div>-->
                    <ul class="zq_ul"></ul>
                </div>
                <div id="shpTitle" class="col-sm-12 select-table table-striped">
                    <table id="bootstrap-table">
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="mouse-position"></div>
<div>
    <div style="float: right; position: absolute;
        float: left;
        right: 51%;
        top: 20px">
        <select id="upperleftSel" onchange="upperleftSel(this.value)" style="width: 60px;">

            <!--<option value="2">3</option>-->

        </select>
    </div>
    <div class="sel">
        <select  id="upperRightSel" onchange="upperRightSel(this.value)" style="width: 60px;">
            <!--<option value="1">1</option>-->
        </select>
    </div>
    <div  style="float: right; position: absolute;
        float: left;
        right: 20px;
        top: 51%;">
        <select id="lowerleftSel" onchange="lowerleftSel(this.value)" style="width: 60px;">
            <!--<option onclick="" value="4">4</option>-->
        </select>
    </div>
    <div style="float: right; position: absolute;
        float: left;
        right: 51%;
        top: 51%;">
        <select id="lowerRightSel" onchange="lowerRightSel(this.value)"  style="width: 60px;">

            <!--<option value="2">2</option>-->

        </select>
    </div>


</div>
</div>
</div>
</body>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: ztree-js"/>
<th:block th:include="include :: ztree-css"/>
<script th:src="@{/js/gis/glmaGis.js}"></script>
<script th:src="@{/js/gis/gisComparison.js}"></script>
<script th:inline="javascript">
    var prefix = ctx + "extinterface/mobileDeviceData";
    var prefixGisMap = ctx + "system/gisMap";
    var prefixGisTab = ctx + "system/gisTab";
    //加载专题数据 点击专题
    function queryDeptTree() {
        type="dept";
        var url = prefixGisMap + "/getList";
        var options = {
            url: url,
            expandLevel: 2,
            check: {enable: true},
            onCheck: zOnClick
        };
        $.tree.init(options);

        function zOnClick(event, tree) {
            var count = map.getLayers().getLength();
            if (count != 4) {
                for (var i = count - 1; i > 3; i--) {
                    map.removeLayer(map.getLayers().item(i));
                }
            }
            var ids = $.tree.getCheckedNodes();
            if (ids != undefined && ids != null && ids != '') {
                $.post(prefixGisMap + "/getListById",
                    {shpIds: ids}, function (res) {
                        for(var i=0;i<res.length;i++){
                            loadgis(res[i].project_type,gisMapName);
                        }
                    })
            }
        }

    }

    //加载业务图层 点击事件
    function serviceTree() {
        type="service";
        var url = ctx + "system/shpFile/treeData";
        var options = {
            url: url,
            expandLevel: 2,
            check: {enable: true},
            onCheck: zOnClick
        };
        $.tree.init(options);

        function zOnClick(event, tree) {
            var count = map.getLayers().getLength();
            if (count != 4) {
                for (var i = count - 1; i > 3; i--) {
                    map.removeLayer(map.getLayers().item(i));
                }
            }
            var ids = $.tree.getCheckedNodes();
            if (ids != undefined && ids != null && ids != '') {
                $.post(prefix + "/getSpot",
                    {shpIds: ids}, function (res) {
                        for (var i = 0; i < res.data.length; i++) {
                            shpInfo(res.data[i]);
                        }
                    })
            }
        }

    }

    $('#btnExpand').click(function () {
        $._tree.expandAll(true);
        $(this).hide();
        $('#btnCollapse').show();
    });
    $('#btnRefresh').click(function () {
        queryDeptTree();
    });

    $('#btnCollapse').click(function () {
        $._tree.expandAll(false);
        $(this).hide();
        $('#btnExpand').show();
    });

    function updateCity() {
        $.get(prefix + "/getDistrictSheng",
            function (res) {
                if (vectorDrawing != null) {
                    map.removeLayer(vectorDrawing);
                }
                var cityHtml = "";
                for (var i = 0; i < res.length; i++) {
                    let cityName="";
                    if(res[i].cityName.length>5){
                        cityName=res[i].cityName.substring(0,5)+"..";
                    }else{
                        cityName=res[i].cityName.substring(0,res[i].cityName.length);
                    }
                    cityHtml += "<li onclick='getSheng(" + res[i].id + ")'>" + cityName + "</li>";
                }
                $(".zq_ul").text("");
                $(".zq_ul").append(cityHtml);
                $("#type3").val('全国');
                $(".content_ul").html('全国');
                $("#dist_positioning").show();
            })
    }

    function getSheng(id) {
        // var view = map.getView();
        $.get(prefix + "/getDistrictShi/" + id, function (res) {
            var cityHtml = "";
            for (var i = 0; i < res.citys.length; i++) {
                cityHtml += "<li onclick='getShi(" + res.citys[i].id + ")'>" + res.citys[i].cityName + "</li>";
            }
            var cityHtm = "<span style='cursor: pointer' onclick='updateCity()'>全国</span> <span style='cursor: pointer;color: #43bfac;' onclick='getSheng(" + res.city.id + ")'> > " + res.city.cityName + "</span>";
            $(".content_ul").html(cityHtm);
            $(".zq_ul").text("");
            $(".zq_ul").append(cityHtml);
            $("#dist_positioning").show();
            var can = res.city.canter.split(",");
            view.setCenter([parseFloat(can[0]), parseFloat(can[1])]);
            view.setZoom(7)
            $("#type3").val(res.city.cityName);
            plotCity(res.city.cityName, "province_name like'" + res.city.cityName + "%'", res.city.id, "division");
        })
    }

    function getShi(id) {
        $.get(prefix + "/getDistrictQu/" + id, function (res) {
            $(".zq_ul").text("");
            var cityHtml = "";
            debugger
            if (res.citys != null) {
                for (var i = 0; i < res.citys.length; i++) {
                    cityHtml += "<li onclick='getQu(" + res.citys[i].id+",&quot;"+res.citys[i].cityName+"&quot;)'>" + res.citys[i].cityName + "</li>";
                }
                $(".zq_ul").append(cityHtml);
            }
            var cityHtm = "<span style='cursor: pointer;color: #43bfac;' onclick='getShi(" + res.city.id + ")'> > " + res.city.cityName + "</span>";
            $(".content_ul").append(cityHtm);
            $("#dist_positioning").show();
            var can = res.city.canter.split(",");
            view.setCenter([parseFloat(can[0]), parseFloat(can[1])]);
            view.setZoom(7)
            $("#type3").val(res.city.cityName);
            plotCity(res.city.cityName, "city_name ='" + res.city.cityName + "'", res.city.id, "division");
        })
    }

    function getQu(id,cityName) {
        $.get(prefix + "/getDistrictById/" + id, function (res) {
            debugger
            var cityHtml = "";
            $(".zq_ul").text("");
            if (res.a5g != null) {
                var leng=res.a5g.length>=4?4:res.a5g.length
                var cityHtml = "";
                var Html = "";
                $("#videoDiv").html("");
                for (var i = 0; i < leng; i++) {
                    if (i==0){
                        cityHtml +=  '<div id="upperleft" style="float: left;width: 50%;height: 50%;border-color:#000000;border-left: 5px "><video controls autoplay="autoplay" muted="muted" loop="loop"><source src="'+'http://47.94.105.131:8088/'+res.a5g[i].url+'" type="video/mp4"><source src="movie.ogg" type="video/ogg"><source src="movie.webm" type="video/webm"></video></div>';
                        $("#upperleftSel").html("");
                        var dev="<option value='" +res.a5g[0].url + "'>" + res.a5g[0].name + "</option>";
                        for (var j = 0; j < res.a5g.length; j++) {
                            dev+= "<option value='" +res.a5g[j].url + "'>" + res.a5g[j].name + "</option>";
                        }
                        $("#upperleftSel").append(dev);
                    }else if (i==1){
                        cityHtml +=  '<div id="upperRight" style="float: left;width: 50%;height: 50%;border-color:#000000;border-left: 5px "><video controls autoplay="autoplay" muted="muted" loop="loop"><source src="'+res.a5g[i].url+'" type="video/mp4"><source src="movie.ogg" type="video/ogg"><source src="movie.webm" type="video/webm"></video></div>';
                        $("#upperRightSel").html("");
                        var dev="<option value='" +res.a5g[1].url + "'>" + res.a5g[1].name + "</option>";
                        for (var j = 0; j < res.a5g.length; j++) {
                            dev += "<option value='" +res.a5g[j].url + "'>" + res.a5g[j].name + "</option>";
                        }
                        $("#upperRightSel").append(dev);
                    }else if (i==2){
                        cityHtml +=  '<div id="lowerleft" style="float: left;width: 50%;height: 50%;border-color:#000000;border-left: 5px "><video controls autoplay="autoplay" muted="muted" loop="loop"><source src="'+res.a5g[i].url+'" type="video/mp4"><source src="movie.ogg" type="video/ogg"><source src="movie.webm" type="video/webm"></video></div>';
                        $("#lowerleftSel").html("");
                        var dev="<option value='" +res.a5g[2].url + "'>" + res.a5g[2].name + "</option>";
                        for (var j = 0; j < res.a5g.length; j++) {
                            dev += "<option value='" +res.a5g[j].url + "'>" + res.a5g[j].name + "</option>";
                        }
                        $("#lowerleftSel").append(dev);
                    }else if (i==3){

                        cityHtml +=  '<div id="lowerRight" style="float: left;width: 50%;height: 50%;border-color:#000000;border-left: 5px "><video controls autoplay="autoplay" muted="muted" loop="loop"><source src="'+res.a5g[i].url+'" type="video/mp4"><source src="movie.ogg" type="video/ogg"><source src="movie.webm" type="video/webm"></video></div>';
                        $("#lowerRightSel").html("");
                        var dev="<option value='lowerRightSel(" +res.a5g[3].url + ")'>" + res.a5g[3].name + "</option>";
                        for (var j = 0; j < res.a5g.length; j++) {
                            dev += "<option value='" +res.a5g[j].url + "'>" + res.a5g[j].name + "</option>";
                        }
                        $("#lowerRightSel").append(dev);
                    }
                }
                $("#videoDiv").append(cityHtml);
                var dev="";

            }
            $("#dist_positioning").show();

            var can = res.city.canter.split(",");
            view.setCenter([parseFloat(can[0]), parseFloat(can[1])]);
            view.setZoom(7)
            $("#type3").val(res.city.cityName);
            plotCity(res.city.cityName, "name='" + res.city.cityName + "'", res.city.id, "qu");

        })
    }
    function upperleftSel(path){
        $("#upperleft").html("");
        var  video='<video controls autoplay="autoplay" muted="muted"><source src="'+path+'" type="video/mp4"><source src="movie.ogg" type="video/ogg"><source src="movie.webm" type="video/webm"></video>';
        $("#upperleft").append(video);
    }
    function upperRightSel(path){
        $("#upperRight").html("");
        var  video='<video controls autoplay="autoplay" muted="muted"><source src="'+path+'" type="video/mp4"><source src="movie.ogg" type="video/ogg"><source src="movie.webm" type="video/webm"></video>';
        $("#upperRight").append(video);
    }
    function lowerleftSel(path){
        $("#lowerleft").html("");
        var  video='<video controls autoplay="autoplay" muted="muted"><source src="'+path+'" type="video/mp4"><source src="movie.ogg" type="video/ogg"><source src="movie.webm" type="video/webm"></video>';
        $("#lowerleft").append(video);
    }
    function lowerRightSel(path){
        $("#lowerRight").html("");
        var  video='<video controls autoplay="autoplay" muted="muted"><source src="'+path+'" type="video/mp4"><source src="movie.ogg" type="video/ogg"><source src="movie.webm" type="video/webm"></video>';
        $("#lowerRight").append(video);
    }
    function cityDivDoneById(name) {
        var newNam = "#" + name;
        $(newNam).hide();
        $("#type3").val('全国');
        if (vectorDrawing != null) {
            map.removeLayer(vectorDrawing);
        }

    }
    $(function () {
        var panehHidden = false;
        if ($(this).width() < 769) {
            panehHidden = true;
        }
        $('body').layout({initClosed: panehHidden, west__size: 185});
        // serviceTree();
    });

    $('.layer_tree_show i').on('click',function () {
        $('.west').show();
        $('.layer_tree_hide').show();
    });

    $('.layer_tree_hide i').on('click',function () {
        $('.west').hide();
        $('.layer_tree_hide').hide();
    });
</script>
<style type="text/css">
    body, html {
        width: 100%;
        height: 100%;
        margin: 0;
        font-family: "微软雅黑";
    }
    #map {
        height: 100%;
        width: 100%;
    }
    #savaInput {
        float: right;
        margin-top: 0px;
        padding-top: 0px;
        padding-bottom: 0px;
    }
    #menu {
        float: right;
        position: absolute;
        bottom: 96%;
        right: 50%;
        z-index: 2000;
    }
    #element2:after{
        content: "2";
        display: block;
        width: 25px;
        height:25px;
        border-radius: 50%;
        background-color: #009966;
        position: relative;
        top: 50px;
        left: 50px;
    }
    #zqdw {
        float: left;
        width: 100%;
    }
    #dist_positioning {
        position: absolute;
        z-index: 10;
        top: 6%;
        width: 380px;
        min-height: 50px;
        background: #fff;
        box-shadow: 0 1px 10px 1px #ccc;
        display: none;
        left: 30px;
    }
    #shpTitle{
        height: 250px;
        bottom: 3px;
        position: absolute;
        z-index: 2001;
        display: none;
    }
    #dist_positioning ul{
        padding: 0px;
    }
    #circle {
        width: 100px;
        height: 100px;
        background-color: #009966;
        border-radius: 50%;
        border: 50px solid lightpink ;
    }
    #dist_positioning ul li {
        float: left;
        width: 90px;
        min-width: 90px;
        text-align: center;
        line-height: 25px;
        padding: 0 8px;
        margin: 2px;
        font-size: 14px;
        cursor: pointer;
        border: 1px solid #efefef;
        word-break: keep-all;
        list-style: none;
    }
    #menu3 {
        float: left;
        position: absolute;
        bottom: 95%;
        left: 30px;
        z-index: 2000;
    }
    input, b {
        margin-left: 5px;
        font-size: 14px
    }
    input {
        margin-top: 10px;
        margin-left: 5px;
        font-size: 14px;
        text-align: center;
    }
    /* 鼠标位置控件层样式设置 */
    #mouse-position {
        float: right;
        position: absolute;
        left: 40%;
        bottom: 5px;
        width: 200px;
        height: 20px;
        /*在地图容器中的层，要设置z-index的值让其显示在地图上层*/
        z-index: 2000;
    }
    .sel{
        position: absolute;
        float: right;
        right: 20px;
        top: 20px;
    }
    #dist_positioning p {
        width: 100%;
        height: 35px;
        line-height: 35px;
        padding-left: 20px;
        font-size: 14px;
        background: #f7f7f7;
    }
    #zqdw .content_ul {
        width: auto;
        min-width: 50px;
        height: 30px;
        line-height: 30px;
        font-size: 12px;
    }
    /* 鼠标位置信息自定义样式设置 */
    .custom-mouse-position {
        color: rgb(0,0,0);
        font-size: 18px;
        font-family: "微软雅黑";
    }
    /**
   * 提示框的样式信息
   */
    .tooltip {
        position: relative;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 4px;
        color: white;
        padding: 4px 8px;
        opacity: 0.7;
        white-space: nowrap;
    }

    .tooltip-measure {
        opacity: 1;
        font-weight: bold;
    }

    .tooltip-static {
        background-color: #ffcc33;
        color: black;
        border: 1px solid white;
    }

    .tooltip-measure:before,
    .tooltip-static:before {
        border-top: 6px solid rgba(0, 0, 0, 0.5);
        border-right: 6px solid transparent;
        border-left: 6px solid transparent;
        content: "";
        position: absolute;
        bottom: -6px;
        margin-left: -7px;
        left: 50%;
    }

    .west{
        position: absolute;
        margin: 0px;
        left: 36px;
        right: auto;
        top: 50px;
        bottom: 0px;
        height: 568px;
        z-index: 1;
        overflow: hidden;
        width: 185px;
        display: none;
        visibility: visible;
    }
    .center{
        position: absolute;
        margin: 0px;
        left: 0px;
        right: 0px;
        top: 0px;
        bottom: 0px;
        height: 100%;
        width: 100%;
        z-index: 0;
        display: block;
        visibility: visible;
    }
    .layer_tree_show{
        position: absolute;
        width: 50px;
        height: 50px;
        left: 36px;
        right: auto;
        top: 50px;
        bottom: 0px;
        z-index: 1;
        font-size: 25px;
        color: #19aa8d;
        cursor: pointer;
    }
    .layer_tree_hide{
        position: absolute;
        width: 25px;
        height: 45px;
        left: 221px;
        right: auto;
        top: 50px;
        bottom: 0px;
        z-index: 1;
        font-size: 25px;
        color: #19aa8d;
        background-color: white;
        /* border-left: 1px solid black; */
        padding-top: 10px;
        cursor: pointer;
        display: none;
    }
    video {
        object-fit: fill;
        width: 100% !important;
        height: 100% !important;
    }
</style>
</html>
