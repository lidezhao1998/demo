<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <th:block th:include="include :: header('左右互选组件')"/>
    <th:block th:include="include :: bootstrap-duallistbox-css"/>
</head>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-title">
                    <h5>长江经济带</h5>
                </div>
                <div class="ibox-content">
                    <form id="form" action="#" class="wizard-big">
                        <select class="form-control dual_select" multiple name="city"
                                th:with="type=${@dict.getType('sys_city')}">
                            <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                    th:value="${dict.dictValue}" th:if="${dict.dictAttribute} ne '1'"></option>
                            <option selected th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                    th:value="${dict.dictValue}" th:if="${dict.dictAttribute} eq '1'"></option>
                        </select>
                    </form>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-offset-5 col-sm-10">
                <button type="button" class="btn btn-sm btn-primary" onclick="btnyizhu()"><i class="fa fa-check"></i>保存</button>
            </div>
        </div>
    </div>
</div>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: bootstrap-duallistbox-js"/>
<script type="text/javascript">
    $('.dual_select').bootstrapDualListbox({
        nonSelectedListLabel: '未选择地区',
        selectedListLabel: '已有地区',
        preserveSelectionOnMove: 'moved',
        moveOnSelect: false,           // 出现一个剪头，表示可以一次选择一个
        filterTextClear: '展示所有',
        moveSelectedLabel: "添加",
        moveAllLabel: '添加所有',
        removeSelectedLabel: "移除",
        removeAllLabel: '移除所有',
        infoText: '共{0}个',
        showFilterInputs: true,       // 是否带搜索
        selectorMinimalHeight: 160
    });
    function btnyizhu() {
        var selected = [];
        var nonselected = [];
        var url = ctx + "system/regional/change";
        $("#bootstrap-duallistbox-selected-list_city>option").each(function(){ //遍历所有option标签
            var text = $(this).attr('value'); //获取option的text
            selected.push(text);
        });
        $("#bootstrap-duallistbox-nonselected-list_city>option").each(function(){ //遍历所有option标签
            var text = $(this).attr('value'); //获取option的text
            nonselected.push(text);
        });
        var a = {
            "selected":selected,
            "nonselected":nonselected
        }

        $.ajax({
            url: url,
            dataType: "json",
            contentType: "application/json;charsetset=UTF-8",//必须
            type: "post",
            cache: false,
            data: JSON.stringify(a),//必须
            success: function (obj) {

                    layer.alert('变更成功！', function (index) {
                        window.location.reload();
                        $.modal.close()
                    });
            },
        });
    }
</script>
</body>
</html>
