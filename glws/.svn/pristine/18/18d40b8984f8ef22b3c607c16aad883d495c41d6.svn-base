<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>加载天地图</title>
    <th:block th:include="include :: header('地图')"/>
    <link th:href="@{/css/gis.css}" rel="stylesheet"/>
</head>
<style>
    /*修改表头颜色*/
    .table-bordered table thead{
        background-color:rgba(48,146,62, 0.9);
        color: whitesmoke;
        height: 25px;
    }
    /*按钮背景色*/
    .btn-success{
        background-color: #30923E;
    }
    .panel-body{
        min-height: 330px;
    }
</style>
<body onLoad="onLoad()">
<div class="ui-layout-center">
    <div class="col-sm-12 search-collapse" id="savaInput">
        <input type="hidden" name="spotinfos" id="spotinfos" value=""><!--保存坐标信息-->
    </div>
    <div class="container-div">
        <div class="row">
            <div id="map">
                <div class="header-r">
                    <div class="header-r-bg">
                        <a href="javascript:;" id="ranging" onclick="measurementGis('LineString')">测距</a>
                        <a href="javascript:;" id="measuringSurface" onclick="measurementGis('Polygon')">测面</a>
                        <a href="javascript:;" id="locationShow">定位</a>
                        <a href="javascript:;" id="markedList">隐藏地图</a>
                        <a href="javascript:;" id="markedTable">隐藏列表</a>
                        <a href="javascript:;" id="showTable">显示列表</a>
                    </div>
                </div>
                <div id="menu">
                    <input type="button" id="off"/>
                </div>
                <div class="layer_tree_show">
                    <div class="layer_tree_show_map"></div>
                </div>
                <div class="layer_tree_hide">
                    <i class="fa fa-chevron-left"></i>
                </div>
                <div class="west">
                    <div class="box box-main">
                        <div class="ui-layout-content" style="height: 420px">
                            <div id="businessLayer" class="ztree" style="overflow-x: scroll;height: 200px;"></div>
                            <div id="thematicLayer" class="ztree" style="overflow-x: scroll;height: 200px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




<div class="tabs-container"  style=" bottom: 0px; position: absolute;width: 100%;" id="hid">
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#tab-1" aria-expanded="true"  style="color: rgba(48,146,62, 0.9)">待办</a>
        </li>
        <li class="active2"><a data-toggle="tab" href="#tab-2" aria-expanded="false" style="color: rgba(48,146,62, 0.9)">已办</a>
        </li>
    </ul>
    <div class="tab-content" >
        <div id="tab-1" class="tab-pane active">
            <div class="panel-body">
                <div class="col-sm-12 select-table table-bordered">

                    <table id="bootstrap-table"></table>
                </div>
            </div>
        </div>


        <div id="tab-2" class="tab-pane">
            <div class="panel-body">
                <div class="col-sm-12 select-table table-bordered">

                    <table id="bootstrap-table2"></table>
                </div>
            </div>
        </div>
    </div>
</div>



<!--
<div class="btn-group-sm" id="toolbar" role="group">
   &lt;!&ndash; <a class="btn btn-success" onclick="$.operate.add()" shiro:hasPermission="system:reserve:add">
        <i class="fa fa-plus"></i> 添加
    </a>&ndash;&gt;

    <form id="formId">
        <div class="select-list">
            <ul>
                <li>
                    <p>库名称：</p>
                    <input type="text" name="librayName"/>
                </li>
                &lt;!&ndash; <li>
                     <p>库管理员：</p>
                     <input type="text" name="librayAdmin"/>
                 </li>
                 <li>
                     <p>地点：</p>
                     <input type="text" name="address"/>
                 </li>&ndash;&gt;

                <li class="select-time">
                    <p>创建时间：</p>
                    <input type="text" class="time-input" id="startTime" placeholder="开始时间" name="params[beginCreatetime]"/>
                    <span>-</span>
                    <input type="text" class="time-input" id="endTime" placeholder="结束时间" name="params[endCreatetime]"/>
                </li>
                <li>
                    <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
                    <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i class="fa fa-refresh"></i>&nbsp;重置</a>
                    <a class="btn btn-primary btn-rounded btn-sm" onclick="closeReportList()"><i class="fa fa-search"></i>&nbsp;关闭</a>

                </li>
            </ul>
        </div>
    </form>
</div>
-->





<!--隐藏地图后只显示列表功能-->
<div class="wrapper wrapper-content animated fadeIn" id="display">

    <div class="row">
        <div class="container-div">
            <div class="row">
                <div id="map">
                    <div class="header-r">
                        <div class="header-r-bg">
                            <a href="javascript:;" id="marked">显示地图</a>
                        </div>
                    </div>
                    <div id="menu">
                        <!-- <label style="cursor: pointer;color: #13c6ae;font-size: 18px" onclick="drawGis('Point','map')">绘点</label>
                         <label style="cursor: pointer;color: #13c6ae;font-size: 18px" onclick="drawGis('Polygon','map')">绘面</label>-->
                        <input type="button" id="off" style="cursor: pointer;color: #13c6ae;font-size: 16px;display: none"/>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-sm-12 search-collapse">
            <form class="form-horizontal m" enctype="multipart/form-data" method="post" style="margin-top: 10px">

                <div class="row">
                    <div class="col-sm-12">
                        <div class="tabs-container" style="margin-left: 0%;margin-right: 0%">

                            <ul class="nav nav-tabs">
                                <li class="active"><a data-toggle="tab" href="#tab-3" aria-expanded="true" style="color: rgba(48,146,62, 0.9)" >待办</a>
                                </li>
                                <li class="active2"><a data-toggle="tab" href="#tab-4" aria-expanded="false"  style="color: rgba(48,146,62, 0.9)" >已办</a>
                                </li>

                            </ul>
                            <div class="tab-content">
                                <div id="tab-3" class="tab-pane active">
                                    <div class="panel-body">
                                        <div class="col-sm-12 select-table table-bordered">
                                            <div class="select-list">
                                                <ul>
                                                    <li>
                                                        <p>样地编号：</p>
                                                        <input type="text" name="sampleNumber"/>
                                                    </li>
                                                    <li>
                                                        <p>省级名称：</p>
                                                        <input type="text" name="provincialLevelName"/>
                                                    </li>
                                                    <li>
                                                        <p>地级名称：</p>
                                                        <input type="text" name="cityLevelName"/>
                                                    </li>
                                                    <li>
                                                        <p>县级名称：</p>
                                                        <input type="text" name="countyLevelName"/>
                                                    </li>


                                                    <li>
                                                        <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
                                                        <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i class="fa fa-refresh"></i>&nbsp;重置</a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <table id="bootstrap-table3"></table>
                                        </div>
                                    </div>
                                </div>


                                <div id="tab-4" class="tab-pane">
                                    <div class="panel-body">
                                        <div class="col-sm-12 select-table table-bordered">
                                            <div class="select-list">
                                                <ul>
                                                    <li>
                                                        <p>样地编号：</p>
                                                        <input type="text" name="codeId"/>
                                                    </li>
                                                    <li>
                                                        <p>省级名称：</p>
                                                        <input type="text" name="provincialLevelName"/>
                                                    </li>
                                                    <li>
                                                        <p>地级名称：</p>
                                                        <input type="text" name="cityLevelName"/>
                                                    </li>
                                                    <li>
                                                        <p>县级名称：</p>
                                                        <input type="text" name="countyLevelName"/>
                                                    </li>

                                                    <li>
                                                        <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
                                                        <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i class="fa fa-refresh"></i>&nbsp;重置</a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <table id="bootstrap-table4"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

</body>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: layout-latest-css"/>
<th:block th:include="include :: ztree-css"/>
<th:block th:include="include :: layout-latest-js"/>
<th:block th:include="include :: ztree-js"/>
<script th:src="@{/js/gis/glwsGis.js}"></script>
<script th:src="@{/js/gis/gisComparison.js}"></script>
<script th:inline="javascript">
    var lngLat = [[${lngLat}]];
    var gid = [[${gid}]];
</script>
<script type="text/javascript">
    var prefixGisMap = ctx + "system/gisMap";
    $(function () {
        var panehHidden = false;
        if ($(this).width() < 769) {
            panehHidden = true;
        }
        $('body').layout({initClosed: panehHidden, west__size: 185});
    });

    function onLoad() {
        load();
        if(lngLat!=null){
            for(var i=0;i<lngLat.length;i++){
                var safdy=lngLat [i].latitude;
                if(safdy!=null && safdy!=''){
                    drawPoint1(safdy);
                }
                if(gid!=null){
                    loadgisByGid(gid);
                }
            }
        }
    }

</script>
<script th:inline="javascript">
    var detailFlag = [[${@permission.hasPermi('system:surveyselect:detail')}]];
    var editFlag = [[${@permission.hasPermi('system:surveyselect:edit')}]];
    var removeFlag = [[${@permission.hasPermi('system:surveyselect:remove')}]];
    var prefix = ctx + "system/surveyassess";

    $("#marked").click(function(){

        document.getElementById("display").style.display="none";//显示
        document.getElementById("map").style.display="";//显示
        document.getElementById("hid").style.display="";//显示


    });
    $("#markedTable").click(function(){

        document.getElementById("hid").style.display="none";//显示
        $("#markedTable").hide()
        $("#showTable").show();

    });

    $("#showTable").click(function(){
        $("#showTable").hide();
        $("#markedTable").show()
        $("#hid").show()

        //document.getElementById("hid").style.display="none";//显示



    });


    $("#markedList").click(function(){
        document.getElementById("map").style.display="none";//显示
        document.getElementById("hid").style.display="none";//显示
        document.getElementById("display").style.display="";//显示



    });
    $(function() {
        $("#showTable").hide()
        document.getElementById("display").style.display="none";//显示

    });
    $(function(){
        var options = {
            id:"bootstrap-table",
            url: prefix + "/list",
            createUrl: prefix + "/add",
            updateUrl: prefix + "/edit/{id}",
            removeUrl: prefix + "/remove",
            detailUrl: prefix + "/detail/{id}",
            exportUrl: prefix + "/export",
            showSearch:false,
            showRefresh:false,
            showColumns:false,
            showToggle:false,
            pageList:[3,6,9,12],//分页步进值
            pageSize: 3,
            onClickRow: onClickRow,
            modalName: "地面调查数据",
            columns: [
                {
                    field : 'title',
                    align: 'center',
                    valign: 'middle',
                    title : '样地编号'
                },
                /*{
                    field : 'countyLevelName',
                    align: 'center',
                    valign: 'middle',
                    title : '县级名称'
                },*/
                {
                    field : 'draftuser',
                    align: 'center',
                    valign: 'middle',
                    title : '起草人'
                },
                {
                    field : 'createTime',
                    align: 'center',
                    valign: 'middle',
                    title : '起草时间'
                },
                {
                    title: '操作',
                    align: 'center',
                    formatter: function(value, row, index) {
                        var actions = [];
                        actions.push('<a class="btn btn-info btn-xs ' + detailFlag + '" href="javascript:void(0)" onclick="detail(\'' + row.id + '\')"><i class="fa fa-search"></i>审核</a> ');
                        return actions.join('');
                    }
                }
            ]
        };
        $.table.init(options);

        $('.reportList').show();
    });

    $(function() {
        var options = {
            id:"bootstrap-table2",
            url: prefix + "/listre",
            createUrl: prefix + "/add",
            updateUrl: prefix + "/edit/{id}",
            removeUrl: prefix + "/remove",
            detailUrl: prefix + "/check/{id}",
            exportUrl: prefix + "/export",
            showSearch:false,
            showRefresh:false,
            showColumns:false,
            showToggle:false,
            pageList:[3,6,9,12],//分页步进值
            pageSize: 3,
            modalName: "地面调查数据",
            columns: [
                {
                    field : 'title',
                    align: 'center',
                    valign: 'middle',
                    title : '样地编号'
                },

                /* {
                     field : 'workflowname',
                     align: 'center',
                     valign: 'middle',
                     title : '县级名称'
                 },*/

                {
                    field : 'draftuser',
                    align: 'center',
                    valign: 'middle',
                    title : '起草人'
                },
                {
                    field : 'readtime',
                    align: 'center',
                    valign: 'middle',
                    title : '审核时间'
                },{
                    title: '操作',
                    align: 'center',
                    formatter: function(value, row, index) {
                        var actions = [];
                        actions.push('<a class="btn btn-info btn-xs ' + detailFlag + '" href="javascript:void(0)" onclick="detailAll(\''+'查看'+row.filetypename+'详情页面\',\'' + row.recordid + '\')"><i class="fa fa-search"></i>查看</a> ');
                        return actions.join('');
                    }
                }
            ]
        };
        $.table.init(options);
    });

    /* 关闭上报信息列表 */
    function closeReportList() {
        $('.reportList').hide();
    }

    /* 标记列表 单击行定位上报图层 */
    /* 单击行定位上报图层 */
    function onClickRow(row, $element) {
        if (row.docid != null) {
            $.get(prefixGisMap + "/getTabById?id=" + row.docid, function (res) {
                console.log(res);
                loadgisByMapId(row.docid, res.centre);
            })
        }
    }

    //图层加载
    function loadgisByMapId(mid, centre) {
        var vector = new ol.layer.Tile({
            source: new ol.source.TileWMS({
                url: gisUrl + urlLayer,
                params: {
                    FORMAT: 'image/png',
                    VERSION: '1.1.1',
                    tiled: true,
                    exceptions: 'application/vnd.ogc.se_inimage',
                    LAYERS: gisMapName,
                    FeatureID: mid
                }
            })
        });
        if(centre!=null){
            var cent= centre.split(",");
            var view = map.getView();
            view.setZoom(12);
            view.setCenter([parseFloat(cent[0]), parseFloat(cent[1])]);
        }
        map.addLayer(vector);
    }
    /* 储备库状态显示 */
    function statusTools(row) {
        if (row.status=='0') {
            return '<i class=\"fa fa-toggle-off text-info fa-2x\" onclick="enable(\'' + row.id + '\')"></i> ';
        } else if (row.status=='1') {
            return '<i class=\"fa fa-toggle-on text-info fa-2x\" onclick="disable(\'' + row.id + '\')"></i> ';
        }
    }

    /* 储备库管理-停用 */
    function disable(id) {
        $.modal.confirm("确认要停用储备库吗？", function() {
            $.operate.post(prefix + "/changeStatus", { "id": id, "status": 0 });
        })
    }

    /* 储备库管理启用 */
    function enable(id) {
        $.modal.confirm("确认要启用储备库吗？", function() {
            $.operate.post(prefix + "/changeStatus", { "id": id, "status": 1 });
        })
    }

    //绘制点
    function drawPoint1(poi) {
        var splitCoord=poi.split(",");
        var point = new ol.Feature({
            geometry: new ol.geom.Point([splitCoord[0], splitCoord[1]])
        });
        //设置点1的样式信息
        point.setStyle(new ol.style.Style({
            //填充色
            fill: new ol.style.Fill({
                color: 'rgba(255, 255, 255, 0.2)'
            }),
            //边线颜色
            stroke: new ol.style.Stroke({
                color: '#ff2c10',
                width: 2
            }),
            //形状
            image: new ol.style.Icon({
                anchor: [0.5, 60],              //锚点
                anchorOrigin:'top-right',       //锚点源
                anchorXUnits: 'fraction',       //锚点X值单位
                anchorYUnits: 'pixels',         //锚点Y值单位
                offsetOrigin: 'top-right',      //偏移原点
                opacity: 0.75,
                src: '/img/cbk.jpg'  //图标的URL
            }),
        }));

        //实例化一个矢量图层Vector作为绘制层
        var source = new ol.source.Vector({
            features: [point]
        });
        //创建一个图层
        var vector = new ol.layer.Vector({
            source: source
        });
        //将绘制层添加到地图容器中
        map.addLayer(vector);
        // 为地图注册鼠标移动事件的监听
        point.on('click', function (e) {
            var prefix = ctx + "zaihai/reserve";
            var url = prefix + '/getListCbkGisMap/'+splitCoord;
            $.modal.openTwo("库详情", url, '320', '550');
        });

    }


    /*隐藏地图后列表*/
    $(function(){
        var options = {
            id:"bootstrap-table3",
            url: prefix + "/list",
            createUrl: prefix + "/add",
            updateUrl: prefix + "/edit/{id}",
            removeUrl: prefix + "/remove",
            detailUrl: prefix + "/detail/{id}",
            exportUrl: prefix + "/export",
            showSearch:false,
            showRefresh:false,
            showColumns:false,
            showToggle:false,
            pageList:[3,6,9,12],//分页步进值
            pageSize: 3,
            onClickRow: onClickRow,
            modalName: "地面调查数据",
            columns: [
                {
                    field : 'title',
                    align: 'center',
                    valign: 'middle',
                    title : '样地编号'
                },
                {
                    field : 'workflowname',
                    align: 'center',
                    valign: 'middle',
                    title : '县级名称'
                },
                {
                    field : 'draftuser',
                    align: 'center',
                    valign: 'middle',
                    title : '起草人'
                },
                {
                    field : 'createTime',
                    align: 'center',
                    valign: 'middle',
                    title : '起草时间'
                },
                {
                    title: '操作',
                    align: 'center',
                    formatter: function(value, row, index) {
                        var actions = [];
                        actions.push('<a class="btn btn-info btn-xs ' + detailFlag + '" href="javascript:void(0)" onclick="detail(\'' + row.id + '\')"><i class="fa fa-search"></i>审核</a> ');
                        return actions.join('');
                    }
                }
            ]
        };
        $.table.init(options);

        $('.reportList').show();
    });

    $(function() {
        var options = {
            id:"bootstrap-table4",
            url: prefix + "/listre",
            createUrl: prefix + "/add",
            updateUrl: prefix + "/edit/{id}",
            removeUrl: prefix + "/remove",
            detailUrl: prefix + "/check/{id}",
            exportUrl: prefix + "/export",
            showSearch:false,
            showRefresh:false,
            showColumns:false,
            showToggle:false,
            pageList:[3,6,9,12],//分页步进值
            pageSize: 3,
            modalName: "地面调查数据",
            columns: [
                {
                    field : 'title',
                    align: 'center',
                    valign: 'middle',
                    title : '样地编号'
                },
                {
                    field : 'workflowname',
                    align: 'center',
                    valign: 'middle',
                    title : '县级名称'
                },
                {
                    field : 'draftuser',
                    align: 'center',
                    valign: 'middle',
                    title : '起草人'
                },
                {
                    field : 'readtime',
                    align: 'center',
                    valign: 'middle',
                    title : '审核时间'
                },{
                    title: '操作',
                    align: 'center',
                    formatter: function(value, row, index) {
                        var actions = [];
                        actions.push('<a class="btn btn-info btn-xs ' + detailFlag + '" href="javascript:void(0)" onclick="detailAll(\''+'查看'+row.filetypename+'详情页面\',\'' + row.recordid + '\')"><i class="fa fa-search"></i>查看</a> ');
                        return actions.join('');
                    }
                }
            ]
        };
        $.table.init(options);
    });



    function detailAll(title,id){
        $.modal.openTab(title,prefix + "/detailAll?groundId="+id);
    }
    function detail(dds){
        $.modal.openTab("核查地面调查数据页面",prefix + "/check/"+dds);

    }
</script>
</html>
