<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <th:block th:include="include :: header('草原虫害发生与防治情况列表')"/>
</head>
<body class="gray-bg">
<style>
    /*修改表头颜色*/
    .table-bordered table thead{
        background-color:rgba(48,146,62, 0.9);
        color: white;
    }
</style>
<div class="container-div">
    <div class="row">
        <div class="col-sm-12 search-collapse">
            <form id="formId">
                <input type="hidden" id="provinceHidden"/>
                <input type="hidden" id="cityHidden"/>
                <div class="select-list">
                    <ul>


                        <!-- <li>
                             <div id="province">
                             <label class="col-sm-3 control-label" style="margin-top: 7px">省：</label>
                             <div class="col-sm-8">
                                 <select id="addrProvince"
                                         style="width: 130px;height: 34px;border:1px solid #e5e6e7"
                                         name="province" onchange="getCities(this.value) "
                                         required="required"></select>
                             </div>
                             </div>
                         </li>-->

                        <li>
                            <div id="province">
                                <span>省份：</span>
                                <select id="addrProvince" name="province" onchange="getCities(this.value)"
                                        style="width: 150px;height:30px; "></select>
                            </div>
                        </li>


                        <li>
                            <div id="city">


                                <!--  <label class="col-sm-3 control-label" style="margin-top: 7px">市：</label>

                                  <div class="col-sm-8">
                                      <select
                                              id="addrCity" name="city"
                                              style="width: 130px;height: 34px;border:1px solid #e5e6e7"
                                              onchange="getAreas(this.value)" required="required"> </select>
                                  </div>-->
                                <span>市：</span>

                                <select
                                        id="addrCity" name="city" onchange="getAreas(this.value)"
                                        style="width: 150px;height:30px; ">
                                </select>
                            </div>
                        </li>
                        <li>
                            <div id="area">
                                <input id="valuearea" type="hidden"/>
                                <em class="i-bit"></em><span>县/区：</span>
                                <select id="addrArea" name="county"
                                        style="width: 150px;height:30px; ">
                                </select>
                            </div>
                        </li>
                        <li class="select-time">
                            <p>年度：</p>
                            <input type="text" name="year" class="layui-layer-input" placeholder="请选择" id="test2"/>
                        </li>
                        <!--<li>-->
                        <!--<label class="col-sm-3 control-label" style="margin-top: 7px;width: 75px;margin-right: -23px;">县/区：</label>-->

                        <!--<div class="col-sm-8">-->
                        <!--<select id="addrArea" name="countyLevelName"-->
                        <!--style="width: 130px;height: 34px;border:1px solid #e5e6e7"-->
                        <!--onchange="getlngLat()" required="required">-->
                        <!--</select>-->
                        <!--</div>-->
                        <!--</li>-->
                        <li>
                            <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i
                                    class="fa fa-search"></i>&nbsp;搜索</a>
                            <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i
                                    class="fa fa-refresh"></i>&nbsp;重置</a>
                        </li>
                    </ul>
                </div>
            </form>
        </div>

        <div class="btn-group-sm" id="toolbar" role="group">
           <!-- <a class="btn btn-warning" onclick="$.table.exportExcel()" shiro:hasPermission="zaihai:chfz:export">
                <i class="fa fa-download"></i> 导出
            </a>-->
            <a class="btn btn-warning" onclick="Echars()" >
                <i class="fa fa-download"></i> 图表展示
            </a>

           <!-- <a class="btn btn-warning" onclick="Echars()" shiro:hasRole="province">
                <i class="fa fa-download"></i> 图表展示
            </a>-->
        </div>
        <div class="col-sm-12 select-table table-bordered">
            <table id="bootstrap-table"></table>
        </div>
    </div>
</div>
<th:block th:include="include :: footer"/>
<script th:inline="javascript">
    var editFlag = [[${@permission.hasPermi('zaihai:chfz:edit')}]];
    var removeFlag = [[${@permission.hasPermi('zaihai:chfz:remove')}]];
    var prefix = ctx + "zaihai/chfztj";

    layui.use('laydate', function () {
        var laydate = layui.laydate;

        //执行一个laydate实例
        laydate.render({
            elem: '#test2'
            , type: 'year'
        });
    });

    $(function () {
        var options = {
            url: prefix + "/list",
            createUrl: prefix + "/add",
            updateUrl: prefix + "/edit/{id}",
            removeUrl: prefix + "/remove",
            exportUrl: prefix + "/export",
            modalName: "草原虫害发生与防治情况",
            detailView: false,
            showSearch: false,
            showToggle: false,
            showColumns: false,
            showRefresh: false,



            /*onExpandRow: function (index, row, $detail) {
                initChildTable(index, row, $detail);
            },*/
            pagination: false,
            showExport: true,
            Icons: 'glyphicon-export',
           /* onExpandRow: function (index, row, $detail) {
                if(row.roleName =='区级'){
                }
                else if(row.roleName =='市级'){
                    //市级用户查看
                    initChildTable2(index, row, $detail);

                }else if (row.roleName == '省级'||row.roleName == '省级审核员') {
                    //省级用户查看
                    initChildTable2(index, row, $detail);
                }else{
                    //国际级用户
                    initChildTable(index, row, $detail);

                }
            },*/

            exportOptions: {
                ignoreColumn: [0, 0],  //忽略某一列的索引
                fileName: '草原虫害发生与防治情况表',  //文件名称设置
                worksheetName: '草原虫害发生与防治',  //表格工作区名称
                tableName: '草原虫害发生与防治情况表',
                excelstyles: ['background-color', 'color', 'font-size', 'font-weight', 'border-top']

                /* ignoreColumn: [0,12],  //忽略某些列的索引数组
                 fileName: '用户列表',  //文件名称设置
                 worksheetName: 'sheet1',  //表格工作区名称
                 tableName: '用户78列表',
                 onMsoNumberFormat: doOnMsoNumberFormat,//大概是处理数字的方法
                 onCellHtmlData: DoOnCellHtmlData,//这个属性方法可以重新修改每一个单元格的值*/
            },

            columns: [[
                /*  {
                      rowspan: 3,
                      colspan: 1,
                      field : 'number',
                      title : '编号',
                      align: 'center',
                      valign: 'middle'
                  },*/
                {
                    rowspan: 3,
                    colspan: 1,
                    field: 'year',
                    title: '年度',
                    align: 'center',
                    valign: 'middle',

                },
                /* {
                     rowspan: 3,
                     colspan: 1,
                     field : 'week',
                     title : '周',
                     align: 'center',
                     valign: 'middle'
                 },*/
                {
                    rowspan: 3,
                    colspan: 1,
                    field: 'province',
                    title: '所属省',
                    align: 'center',
                    valign: 'middle',
                    formatter: function(value, row, index){
                        if(value=='合计'){
                            return "合计";
                        }else{
                            return '<a href="javascript:void(0)" onclick="detailList(\'' + row.province + '\')">' + value + '</a>';
                        }
                    }
                },
                 {
                     rowspan: 3,
                     colspan: 1,
                     field : 'city',
                     title : '所属市',
                     align: 'center',
                     valign: 'middle',
                     formatter: function(value,row,index){
                        if(value==null || value==""){
                            return "合计";
                        }else{
                            return '<a href="javascript:void(0)" onclick="cityList(\''+ row.city+ '\')">'+value+'</a>';
                        }
                     }
                 },
                 {
                     rowspan: 3,
                     colspan: 1,
                     field : 'county',
                     title : '所属县',
                     align: 'center',
                     valign: 'middle'

                 },
                /*{
                    rowspan: 3,
                    colspan: 1,
                    field : 'type',
                    title : '类型',
                    align: 'center',
                    valign: 'middle'
                },*/
                {
                    rowspan: 1,
                    colspan: 2,
                    title: '危害情况(万亩)',
                    align: 'center',
                    valign: 'middle'
                },

                /* {
                     rowspan: 3,
                     colspan: 1,
                     field : 'totalPrevention',
                     title : '合计',
                     align: 'center',
                     valign: 'middle'
                 },

                 {
                     rowspan: 3,
                     colspan: 1,
                     field : 'chemistryControl',
                     title : '化学防治',
                     align: 'center',
                     valign: 'middle'
                 },*/
                {
                    rowspan: 1,
                    colspan: 15,
                    title: '当年防治面积(万亩)',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 9,
                    title: '防治投入',
                    align: 'center',
                    valign: 'middle'
                },


                {
                    rowspan: 3,
                    colspan: 1,
                    field: 'remarks',
                    title: '备注',
                    align: 'center',
                    valign: 'middle'
                }
            ], [
                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'harmTotalarea',
                    title: '危害总面<br>积',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'engineeringhazard',
                    title: '工程区危<br>害面积',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 13,
                    title: '生物防治面积(万亩)',
                    align: 'center',
                    valign: 'middle'
                },

                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'chemistryControl',
                    title: '化学防治',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'totalPrevention',
                    title: '合计',
                    align: 'center',
                    valign: 'middle'
                },


                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'expatriateManagers',
                    title: '管理技术<br>干部（人/天）',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'work',
                    title: '出工（人/天）',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'plane',
                    title: '飞机（架/次）',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'bigSprayer',
                    title: '大型喷雾<br>器（台/套/天）',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'smallSprayer',
                    title: '中小型喷<br>雾器（台/套/天）',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'car',
                    title: '车辆（辆/天）',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'pastureChickenNum',
                    title: '牧鸡（万只）',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'pastureDuckNum',
                    title: '牧鸭（万只）',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 2,
                    colspan: 1,
                    field: 'starlingNest',
                    title: '椋鸟巢（立方米）',
                    align: 'center',
                    valign: 'middle'
                }
            ], [

                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'subtotal',
                    title: '小计',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'attractStarlings',
                    title: '招募椋鸟',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'pastureChicken',
                    title: '牧鸡',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'pastureDuck',
                    title: '牧鸭',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'matrine',
                    title: '苦参碱',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'nicotine',
                    title: '烟碱',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'greenMuscardineFungus',
                    title: '绿僵菌',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'azadirachtin',
                    title: '印楝素',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'avermectin',
                    title: '阿维菌素',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'empedobacterBrevis',
                    title: '短稳杆菌',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'osthole',
                    title: '蛇床子素',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'weiSu',
                    title: '阿维苏',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    rowspan: 1,
                    colspan: 1,
                    field: 'enterocytozoonBieneusi',
                    title: '微孢子虫',
                    align: 'center',
                    valign: 'middle'
                },
                /*{
                    field: 'wlScale',
                    title: '合计',
                    align: 'center',
                    valign: 'middle',
                    footerFormatter:function (value) {
                        var sumBalance = 0;
                        for (var i in value) {
                            sumBalance += parseFloat(value[i].wlScale);
                        }
                        return sumBalance.toFixed(2);
                    }
                },*/

            ]],
            onLoadSuccess: function (row) {
                var roleName= [[${roleName}]];
                var code = row.rows[0].code;
                var length= row.rows.length;
                if (roleName=='国家级') {
                    $('#city').hide();
                    $('#bootstrap-table').bootstrapTable('hideColumn', 'city');
                    $('#bootstrap-table').bootstrapTable('hideColumn', 'county');
                    document.getElementById("bootstrap-table").rows[length+2].cells[0].innerHTML="-";
                }else if(roleName=='省级'){
                    $('#area').hide();
                    if (code!=null &&code!=''){
                        $("#addrProvince").val(code);
                    }
                    getCities(code)
                    $('#province').hide();
                    $('#bootstrap-table').bootstrapTable('hideColumn', 'province');
                    $('#bootstrap-table').bootstrapTable('hideColumn', 'county');
                    document.getElementById("bootstrap-table").rows[length+2].cells[0].innerHTML="-";
                }else if(roleName=='市级'){
                    row.rows.pop()
                    if (code!=null &&code!=''){
                        /*$("#provinceHidden").val(code);*/
                        $("#addrCity").val(code);
                    }
                    getAreas(code)
                    $('#city').hide();
                    $('#province').hide();
                    $('#bootstrap-table').bootstrapTable('hideColumn', 'province');
                    $('#bootstrap-table').bootstrapTable('hideColumn', 'city');
                    /*$('#bootstrap-table').bootstrapTable('hideColumn', 'county');*/
                }else if(roleName=='区级'){
                    row.rows.pop()
                    $('#search').hide();
                    $('#bootstrap-table').bootstrapTable('hideColumn', 'city');
                    $('#bootstrap-table').bootstrapTable('hideColumn', 'province');
                }else if(roleName=='省级审核员'){
                    debugger
                    if (code!=null &&code!=''){
                        $("#provinceHidden").val(code);
                    }

                    getCities(code)
                    $('#province').hide();
                    $('#bootstrap-table').bootstrapTable('hideColumn', 'province');

                    $('#bootstrap-table').bootstrapTable('hideColumn', 'county');
                    document.getElementById("bootstrap-table").rows[length+2].cells[0].innerHTML="-";
                }

            }
        };
        $.table.init(options);
    });
    $(function () {
        getProvinces();
    });

    //子表列表
    initChildTable = function (index, row, $detail) {
        // alert(JSON.stringify(row))
        var province = row.province;
        var cur_table = $detail.html('<div ><table style="background:#E6E6FA" border="0" ></div></table>').find('table');
        $(cur_table).bootstrapTable({
            url: prefix + "/ParentList",
            method: 'post',
            detailView: false,
            onExpandRow: function (index, row, $detail) {
                initChildTable2(index, row, $detail);
            },
            sidePagination: "server",
            contentType: "application/x-www-form-urlencoded",   // 编码类型
            queryParams: {
                province: province,
            },
            columns: [

                {
                    field: 'year',
                    width: '1%',
                },

                {
                    field: 'city',
                    width: '2%',

                },
                {
                    field: 'harmTotalarea',
                    align: 'top',
                    valign: 'middle',
                    width: '3.3%'

                },
                {
                    field: 'engineeringhazard',
                    align: 'center',
                    valign: 'middle',
                    width: '3.1%'

                },

                {
                    field: 'subtotal',
                    align: 'center',
                    valign: 'middle',
                    width: '2.2%'

                },
                {
                    field: 'attractStarlings',
                    align: 'center',
                    valign: 'middle',
                    width: '3.3%'

                },
                {

                    field: 'pastureChickenNum',
                    align: 'center',
                    valign: 'middle',
                    width: '1%'

                },
                {

                    field: 'pastureDuckNum',
                    align: 'center',
                    valign: 'middle',
                    width: '2%'

                },
                {

                    field: 'matrine',
                    align: 'center',
                    valign: 'middle',
                    width: '2.4%'

                },
                {
                    field: 'nicotine',
                    align: 'center',
                    valign: 'middle',
                    width: '2.8%'

                },
                {
                    field: 'greenMuscardineFungus',
                    align: 'center',
                    valign: 'middle',
                    width: '2.7%'
                },

                {
                    field: 'azadirachtin',
                    align: 'center',
                    width: '2.4%',
                    valign: 'middle'
                },
                {
                    field: 'avermectin',
                    align: 'center',
                    width: '3.2%',
                    valign: 'middle'
                },
                {
                    field: 'empedobacterBrevis',
                    align: 'center',
                    width: '3.2%',
                    valign: 'middle'
                },
                {
                    field: 'osthole',
                    align: 'center',
                    width: '3.2%',
                    valign: 'middle'
                },
                {
                    field: 'weiSu',
                    align: 'center',
                    width: '2.5%',
                    valign: 'middle'
                },
                {
                    field: 'enterocytozoonBieneusi',
                    align: 'center',
                    width: '3.3%',
                    valign: 'middle'
                },
                {
                    field: 'chemistryControl',
                    align: 'center',
                    width: '3.3%',

                    valign: 'middle'
                },


                {
                    field: 'totalPrevention',
                    align: 'center',
                    width: '2.6%',

                    valign: 'middle'
                },
                {
                    field: 'expatriateManagers',
                    align: 'center',
                    width: '4.3%',


                    valign: 'middle'
                },
                {
                    field: 'work',
                    align: 'center',
                    width: '4.6%',


                    valign: 'middle'
                },
                {
                    field: 'plane',
                    align: 'center',
                    width: '4.6%',

                    valign: 'middle'
                },
                {
                    field: 'bigSprayer',
                    align: 'center',
                    width: '4.6%',


                    valign: 'middle'
                },
                {
                    field: 'smallSprayer',
                    align: 'center',
                    width: '5.3%',

                    valign: 'middle'
                },
                {
                    field: 'car',
                    align: 'center',
                    width: '4.5%',

                    valign: 'middle'
                },
                {
                    field: 'pastureChickenNum',
                    align: 'center',
                    width: '4.5%',
                    valign: 'middle'
                },
                {
                    field: 'pastureDuckNum',
                    align: 'center',
                    width: '4.5%',
                    valign: 'middle'
                },
                {
                    field: 'starlingNest',
                    align: 'center',
                    width: '5%',

                    valign: 'middle'
                },
                {
                    field: 'remarks',
                    align: 'center',
                    valign: 'middle'
                },

            ],

        });
    };

    //子表的子列表
    initChildTable2 = function (index, row, $detail) {
        var city = row.city;
        var cur_table = $detail.html('<div style="padding-left: 21px;"><table style="background:#D4F2E7" border="0" ></div></table>').find('table');
        $(cur_table).bootstrapTable({
            url: prefix + "/ParentList",
            method: 'post',
            sidePagination: "server",
            contentType: "application/x-www-form-urlencoded",   // 编码类型
            queryParams: {
                city: city,

            },
            columns: [

                {
                    field: 'year',
                    width: '1%',
                },

                {
                    field: 'county',
                    width: '2%',

                },
                {
                    field: 'harmTotalarea',
                    align: 'top',
                    valign: 'middle',
                    width: '3.3%'

                },
                {
                    field: 'engineeringhazard',
                    align: 'center',
                    valign: 'middle',
                    width: '3.1%'

                },

                {
                    field: 'subtotal',
                    align: 'center',
                    valign: 'middle',
                    width: '3%'

                },
                {
                    field: 'attractStarlings',
                    align: 'center',
                    valign: 'middle',
                    width: '3.1%'

                },
                {

                    field: 'pastureChickenNum',
                    align: 'center',
                    valign: 'middle',
                    width: '3.1%'

                },
                {

                    field: 'pastureDuckNum',
                    align: 'center',
                    valign: 'middle',
                    width: '3.1%'

                },
                {

                    field: 'matrine',
                    align: 'center',
                    valign: 'middle',
                    width: '2.6%'

                },
                {
                    field: 'nicotine',
                    align: 'center',
                    valign: 'middle',
                    width: '3%'

                },
                {
                    field: 'greenMuscardineFungus',
                    align: 'center',
                    valign: 'middle',
                    width: '2.8%'
                },

                {
                    field: 'azadirachtin',
                    align: 'center',
                    width: '2.6%',
                    valign: 'middle'
                },
                {
                    field: 'avermectin',
                    align: 'center',
                    width: '3.2%',
                    valign: 'middle'
                },
                {
                    field: 'empedobacterBrevis',
                    align: 'center',
                    width: '3.2%',
                    valign: 'middle'
                },
                {
                    field: 'osthole',
                    align: 'center',
                    width: '3.2%',
                    valign: 'middle'
                },
                {
                    field: 'weiSu',
                    align: 'center',
                    width: '2.5%',
                    valign: 'middle'
                },
                {
                    field: 'enterocytozoonBieneusi',
                    align: 'center',
                    width: '3.3%',
                    valign: 'middle'
                },
                {
                    field: 'chemistryControl',
                    align: 'center',
                    width: '3.3%',

                    valign: 'middle'
                },


                {
                    field: 'totalPrevention',
                    align: 'center',
                    width: '2.6%',

                    valign: 'middle'
                },
                {
                    field: 'expatriateManagers',
                    align: 'center',
                    width: '4.3%',


                    valign: 'middle'
                },
                {
                    field: 'work',
                    align: 'center',
                    width: '4.6%',


                    valign: 'middle'
                },
                {
                    field: 'plane',
                    align: 'center',
                    width: '4.6%',

                    valign: 'middle'
                },
                {
                    field: 'bigSprayer',
                    align: 'center',
                    width: '4.6%',


                    valign: 'middle'
                },
                {
                    field: 'smallSprayer',
                    align: 'center',
                    width: '5.3%',

                    valign: 'middle'
                },
                {
                    field: 'car',
                    align: 'center',
                    width: '4.5%',

                    valign: 'middle'
                },
                {
                    field: 'pastureChickenNum',
                    align: 'center',
                    width: '4.5%',
                    valign: 'middle'
                },
                {
                    field: 'pastureDuckNum',
                    align: 'center',
                    width: '4.5%',
                    valign: 'middle'
                },
                {
                    field: 'starlingNest',
                    align: 'center',
                    width: '5%',

                    valign: 'middle'
                },
                {
                    field: 'remarks',
                    align: 'center',
                    valign: 'middle'
                },

            ],
        });
    };



    function getProvinces() {
        //  var url = "<%=basePath%>dict/getProvinces";
        var url = ctx + "caiji/survey/getProvinces";
        $.ajax({
            "url": url,
            "type": "GET",
            "dataType": "json",
            "success": function (data) {
                //alert(JSON.stringify(data))
                var op = document.createElement("option");
                op.value = '';
                op.text = "----- 请选择省 -------";
                document.getElementById("addrProvince").appendChild(op);
                for (var i = 0; i < data.length; i++) {
                    var op = document.createElement("option");
                    op.value = data[i].dictLabel;
                    op.text = data[i].dictLabel;
                    document.getElementById("addrProvince").appendChild(op);
                }
            }
        });
        getCities();
    }

    // ===== 加载市列表 =====
    function getCities(value) {
        $("#addrCity").empty();
        $("#addrArea").empty();
        var url = ctx + "caiji/survey/getCities";
        /*var data = "provinceCode=" + $("#provinceHidden").val();*/
        var data = "provinceCode=" + value;
        $.ajax({
            "url": url,
            "data": data,
            "type": "GET",
            "dataType": "json",
            "success": function (data) {
                var op = document.createElement("option");
                op.value = '';
                op.text = "----- 请选择市 -------";
                document.getElementById("addrCity").appendChild(op);
                for (var i = 0; i < data.length; i++) {
                    var op = document.createElement("option");
                    op.value = data[i].dictLabel;
                    op.text = data[i].dictLabel;
                    document.getElementById("addrCity").appendChild(op);
                }
            }
        });
        getAreas();
        // var op2 = document.createElement("option");
        // op2.value = '';
        // document.getElementById("addrArea").appendChild(op2);
    }
    // ===== 加载区列表 =====
    function getAreas(value) {
        $("#addrArea").empty();
        $("#addrdz").empty();
        //var url = "<%=basePath%>dict/getAreas";
        var url = ctx + "caiji/survey/getAreas";
        /*var data = "cityCode=" +  $("#addrCity").val();*/
        var data = "cityCode=" +  value;
        $.ajax({
            "url": url,
            "data": data,
            "type": "GET",
            "dataType": "json",
            "success": function (data) {
                var op = document.createElement("option");
                op.value = '';
                op.text = "----- 请选择县/区 -------";
                document.getElementById("addrArea").appendChild(op);
                for (var i = 0; i < data.length; i++) {
                    var op = document.createElement("option");
                    op.value = data[i].dictLabel;
                    op.text = data[i].dictLabel;
                    document.getElementById("addrArea").appendChild(op);
                }
            }
        });

    }




    function Echars() {
        var url = prefix + '/Echars';
        $.modal.openFull("虫害发生防治情况统计图", url);
    }

    /** 查询省级详情*/
    function detailList(province) {
        var url = prefix + '/detailList/'+ province;
        $.modal.openTab("虫害区县发生与防治列表", url);
    }

    /** 查询市级详情 */
    function cityList(city){
        var url = prefix + '/cityList/' + city;
        $.modal.openTab("虫害区县发生与防治列表", url);
    }

</script>
</body>
</html>