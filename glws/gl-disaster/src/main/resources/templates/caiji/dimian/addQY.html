<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('新增取样信息')"/>
    <th:block th:include="include :: datetimepicker-css"/>
    <th:block th:include="include :: bootstrap-fileinput-css"/>
    <th:block th:include="include :: select2-css"/>
    <th:block th:include="include :: bootstrap-select-css"/>
    <style type="text/css">



        .col-sm-3 {
            color: #333;
        }

        .form-control {
            color: #333;
        }

        .form-group1 {
            margin-left: 80px;
        }

        .col-sm-pt {
            width: 95%;
        }

        /*修改表头颜色*/
        .table-striped table thead {
            background-color: rgba(48, 146, 62, 0.9);
            color: whitesmoke;
            height: 55px;
        }

        .daohang {
            float: right;
            width: 120px;
            margin-right: 20px;

        }
        .kv-file-content{
            width: 100px;
            height: 50px;
        }
        .file-footer-caption{
            width: 100px;
            height: 30px;
            margin-bottom:10px;
        }
        .button-p{
        margin-left: 87%;
        }
        .footeer{
            margin-top: 30px;
        }
    </style>
</head>
<body class="white-bg">

<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal " id="form-survey-add">
        <div class="col-sm-12 search-collapse quyangAdd">
            <form id="formId">
                <div class="select-list">
                    <ul>
                        <li>
                            <p class="Addtitle">请选择取样生物种类：</p>
                            <select id="Addtitle" name="harmfulSpeciesType"
                                    th:with="type=${@dict.getType('di_qu_Biological_species')}">
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                        th:value="${dict.dictValue}">
                                </option>
                            </select>
                        </li>
                        <li>
                            <a class="btn btn-success" onclick="addTabQuy()"><i
                                    class="fa fa-plus"></i> 添加</a>
                        </li>
                    </ul>
                </div>
            </form>
        </div>


        <div class="col-sm-12 select-table table-striped">

            <table id="bootstrap-table3"></table>

        </div>



    </form>
    <div class="footeer">
    <div class="button-p" >
      <!--  <button type="button" class="btn btn-w-m btn-primary" th:onclick="saveYiQy()"  >保存并新增取样</button>&nbsp;
         <button type="button" class="btn btn-w-m btn-primary" th:onclick="saveYi()"  ></i>保 存</button>&nbsp;-->

        <button type="button" class="btn btn-w-m btn-danger" onclick="successCallback1()"></i>关 闭 </button>
    </div>
    </div>
</div>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: datetimepicker-js"/>
<th:block th:include="include :: bootstrap-fileinput-js"/>
<th:block th:include="include :: select2-js"/>
<th:block th:include="include :: bootstrap-select-js"/>
<th:block th:include="include :: uploadImg-js"/>
<script type="text/javascript">

    var prefix = ctx + "caiji/survey";

    var prefix2 = ctx + "caiji/plot";

</script>
<script type="text/javascript">


    var groundID = [[${groundID}]];

    /** 刷新选项卡 */
    function refreshItem(currentId) {
        var topWindow = $(window.parent.parent.document);
        var target = $('.RuoYi_iframe[data-id="' + currentId + '"]', topWindow);
        var url = target.attr('src');
        target.attr('src', url).ready();
    };




    function successCallback1() {

        refreshItem("/caiji/survey");
        closeItem();


        $.modal.alertWarning(result.msg)

        $.modal.alertError(result.msg);
        $.modal.closeLoading();
        $.modal.enable();
    }











    //取样添加
    function addTabQuy() {
        // alert(1)
        var type = $('#Addtitle option:selected').val();
        // alert(type)
        var url = "";
        var title = "";
        if (type == 001) {
            //害虫
            url = prefix + '/addPest/' + groundID;
            title = "新增害虫信息";

            // $.modal.open("新增害虫信息", url);

            // $.modal.msgError("请选择添加取样生物类型");
        } else if (type == 002) {
            //害鼠
            url = prefix + '/addVermin/' + groundID;
            title = "新增害鼠信息";
            //$.modal.open("新增害鼠信息", url);
            // $.modal.msgError("请选择添加取样生物类型");
        } else if (type == 003) {
            //病害
            url = prefix + '/addDisease/' + groundID;
            title = "新增病害信息";
            //$.modal.open("新增病害信息", url);
            // $.modal.msgError("请选择添加取样生物类型");
        } else if (type == 004) {
            //毒害草
            url = prefix + '/addWeed/' + groundID;
            title = "新增毒害草信息";
            // $.modal.open("新增毒害草信息", url);
            // $.modal.msgError("请选择添加取样生物类型");
        }
        $.modal.open(title, url);

    }

    $(function () {
        var prefix1 = ctx + "caiji/plot";
        var options = {
            id: "bootstrap-table3",
            url: prefix1 + "/listY/"+groundID,
            updateUrl: prefix1 + "/edit/{id}",
            removeUrl: prefix1 + "/remove",
            pagination: true,
            pageList: [3, 6, 9, 12],//分页步进值
            pageSize: 3,
            showRefresh: false,
            showColumns: false,
            showToggle: false,
            showSearch: false,

            modalName: "取样数据",
            columns: [
                {
                    field: 'id',
                    title: '序号',
                    width: 5,
                    align: 'center',
                    valign: 'middle',
                    switchable: false,
                    formatter: function (value, row, index) {
                        //return index+1; //序号正序排序从1开始
                        var pageSize1 = $('#bootstrap-table3').bootstrapTable('getOptions').pageSize;//通过表的#id 可以得到每页多少条
                        var pageNumber = $('#bootstrap-table3').bootstrapTable('getOptions').pageNumber;//通过表的#id 可以得到当前第几页
                        return pageSize1 * (pageNumber - 1) + index + 1;    //返回每条的序号： 每页条数 * （当前页 - 1 ）+ 序号
                    }
                },
                {
                    field: 'samplingNumber',
                    align: 'center',
                    valign: 'middle',
                    title: '取样编号'
                },
                {
                    field: 'samplingArea',
                    align: 'center',
                    valign: 'middle',
                    title: '取样面积类型'
                },
                {
                    field: 'harmfulSpeciesType',
                    align: 'center',
                    valign: 'middle',
                    title: '有害生物种类',
                    /* formatter:function(value,row,index){
           /!*        $.ajax({
                             "url": prefix + "/dict?dict=di_qu_Biological_species",
                             "type": "GET",
                             "dataType": "json",
                             "success": function (data) {
                                 /!*   console.log(JSON.stringify(data));*!/
                                 var opt = "";
                                 if (data.msg == "操作成功") {
                                     var dictDatalist = data.dictData;
                                     for (var i in dictDatalist) {
                                         alert("dictDatalist[i].dictValue---"+dictDatalist[i].dictValue)
                                         alert("dictDatalist[i].dictLabel---"+dictDatalist[i].dictLabel)
                                         alert(dictDatalist[i].dictValue==row.harmfulSpeciesType)
                                         if(dictDatalist[i].dictValue==row.harmfulSpeciesType)
                                         {
                                             alert("1111111");
                                                       return dictDatalist[i].dictLabel;
                                         }

                                     }


                                 }


                             }
                         });*!/
                         var arrayObj = new Array();
                         for (var i in dictData) {
                             var obj={
                             }
                             obj["dictValue"]=dictData[i]
                             obj["dictLabel"]=dictDatas[i]
                             arrayObj.push(obj);

                         }
                       for (var i in arrayObj) {
                             if(arrayObj[i].dictValue==row.harmfulSpeciesType)
                             {
                                 return arrayObj[i].dictLabel;
                             }

                         }

                     }*/

                },
                {
                    field: 'quantityDetermination',
                    align: 'center',
                    valign: 'middle',
                    title: '测定数量'
                },
                /*{
                    field : 'photo',
                    align: 'center',
                    valign: 'middle',
                    title : '照片'
                },*/
                /*{
                    field : 'status',
                    align: 'center',
                    valign: 'middle',
                    title : '状态',
                    formatter: function (value, row, index) {
                        return statusTool(row);
                    }
                },*/

                {
                    title: '操作',
                    align: 'center',
                    valign: 'middle',
                    formatter: function (value, row, index) {
                        var actions = [];
                        actions.push('<a class="btn btn-danger btn-xs " href="javascript:void(0)" onclick="$.operate.remove(\'' + row.plotId + '\')"><i class="fa fa-remove"></i>删除</a>&nbsp');
                        actions.push('<a class="btn btn-success btn-xs " href="javascript:void(0)" onclick="$.operate.edit(\'' + row.plotId + '\')"><i class="fa fa-edit"></i>编辑</a>  ');
                        return actions.join('');
                    }
                }
            ]
        };
        $.table.init(options);
    });
    function successCallback1() {
        refreshItem("/caiji/survey");
        $.modal.closeTab();
    }

</script>

</body>
</html>