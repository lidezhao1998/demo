<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('新增地面调查数据')"/>
    <th:block th:include="include :: datetimepicker-css"/>
    <th:block th:include="include :: bootstrap-fileinput-css"/>
    <th:block th:include="include :: select2-css"/>
    <th:block th:include="include :: bootstrap-select-css"/>
    <style type="text/css">
        .tg-0lax {
            text-align: center;
            vertical-align: middle;
            color: #333;
        }

        table {
            background-color: white;
            margin-left: 35px;
        }

        .col-sm-3 {
            color: #333;
        }

        .form-control {
            color: #333;
        }

        .form-group1 {
            margin-left: 80px;
        }

        .col-sm-pt {
            width: 95%;
        }

        /*修改表头颜色*/
        .table-striped table thead {
            background-color: rgba(48, 146, 62, 0.9);
            color: whitesmoke;
            height: 55px;
        }

        .daohang {
            float: right;
            width: 120px;
            margin-right: 20px;

        }
        .kv-file-content{
            width: 100px;
            height: 50px;
        }
        .file-footer-caption{
            width: 100px;
            height: 30px;
            margin-bottom:10px;
        }
        .button-p{
            margin-left: 65%;

            display:inline;
        }
        .footeer{
            margin-top: 30px;
        }

        .btn1 {
            display: inline-block;
            margin-left: -30px;
            padding: 4px;
            margin-bottom: 0;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.42857143;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            touch-action: manipulation;
            cursor: pointer;
            user-select: none;
            background-image: none;
            border: 1px solid transparent;
        }

    </style>
</head>
<body class="white-bg">

<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form id="formIds">
        <input id="id" name="id" type="text" hidden>
    </form>
    <form class="form-horizontal " id="form-survey-add" enctype="multipart/form-data" method="post" th:object="${cGroundSurvey}">
        <input id="photoUrl" name="photoUrl" type="text" hidden>
        <input id="groundId" name="groundId" type="text" hidden>
        <input id="mapId" name="mapId" type="text" hidden>
        <input id="addrProvince" name="provincialLevelName" type="text"  th:field="*{provincialLevelName}"   hidden>
        <input id="addrCity" name="cityLevelName" type="text"  th:field="*{cityLevelName}"   hidden>
        <input id="addrArea" name="countyLevelName" type="text"   th:field="*{countyLevelName}"   hidden>

        <h4 class="form-header h4">样地基本信息（编号规则S：鼠、虫、病、毒害草首字母，YYYY：年份；XXXXXX：县级行政代码；1、2、3：顺序号）</h4>
        <div class="yangdixinxi">
            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group" style="text-align: center;">
                        <label class="col-sm-3 control-label"><span style="color: red; ">*</span>样地类型：</label>
                        <div class="col-sm-8" style="display: inline-block">
                            <select id="codeId"  name="codeId" class="form-control noselect2 selectpicker" th:with="type=${@dict.getType('di_bian_shou')}" required>
                                <option value="">请选择类型系统自动生成编号</option>
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}">
                                </option>
                            </select>

                        </div>

                        <!--<a class="btn1 btn-success btn-rounded" th:onclick="bianhao()">选择</a>-->

                    </div>
                </div>

                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">绘图：</label>
                        <div class="col-sm-8">
                            <a class="btn btn-success" id="ht" onclick="ht()">
                                <i class="fa fa-plus"></i> 样地绘图
                            </a>
                            <a class="btn btn-success" id="hiddenht" onclick="hiddenht()" style="display: none">
                                <i class="fa fa-plus"></i> 回显绘图
                            </a>
                        </div>
                    </div>
                </div>
                <!--<div class="col-sm-6">
                    <div class="form-group">
                        &lt;!&ndash;
                                                                    <label class="col-sm-3 control-label">*省级名称：</label>
                        &ndash;&gt;
                        <label class="col-sm-3 control-label"><span style="color: red; ">*</span>省级名称：</label>

                        <div class="col-sm-8">
                            &lt;!&ndash; < select name="provincialLevelName" class="form-control noselect2 selectpicker" th:with="type=${@dict.getType('sys_province')}" >
                             <option value="">请选择</option>
                             <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}">
                             </option>
                             </select>&ndash;&gt;
                            <select id="addrProvince"
                                    style="width: 360px;height: 34px;border:1px solid #e5e6e7"
                                    name="provincialLevelName" onchange="getCities() "
                                    required="required">
                                <option value="">-&#45;&#45;&#45;&#45; 所在省 -&#45;&#45;&#45;&#45;&#45;&#45;</option>

                            </select>
                        </div>
                    </div>

                </div>-->

            </div>
            <!-- <div class="row">
                 <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label"><span style="color: red; ">*</span>地级名称：</label>

                         <div class="col-sm-8">
                             <select
                                     id="addrCity" name="cityLevelName"
                                     style="width: 360px;height: 34px;border:1px solid #e5e6e7"
                                     onchange="getAreas()" required="required">
                                 <option value="">-&#45;&#45;&#45;&#45; 所在市 -&#45;&#45;&#45;&#45;&#45;&#45;</option>

                             </select></div>
                     </div>
                 </div>

                 <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label"><span style="color: red; ">*</span>县级名称：</label>

                         <div class="col-sm-8">
                             <select id="addrArea" name="countyLevelName"
                                     style="width: 360px;height: 34px;border:1px solid #e5e6e7"
                                     onchange="getlngLat()" required="required">
                                 <option value="">-&#45;&#45;&#45;&#45; 所在区 -&#45;&#45;&#45;&#45;&#45;&#45;</option>

                             </select>
                         </div>
                     </div>

                 </div>
             </div>-->

            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">坡位：</label>
                        <div class="col-sm-8">
                            <input name="slopePositionType" class="form-control" type="text" placeholder="可填:上坡、中坡、下坡、全坡">
                        </div>
                    </div>
                </div>


                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">坡向：</label>
                        <div class="col-sm-8">
                            <input name="asceptType" class="form-control" type="text"  placeholder="例如:东南、西南、西北">
                        </div>
                    </div>
                </div>

            </div>

            <div class="row">

                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">坡度：</label>
                        <div class="col-sm-8">
                            <input name="fallingGradient" class="form-control" type="text" onkeyup="value=value.replace(/^\D*(\d*(?:\.\d{0,2})?).*$/g, '$1')" placeholder="例如:0.5、1.2">
                        </div>
                    </div>

                </div>
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">地表特征：</label>
                        <div class="col-sm-8">
                            <select name="surfaceFeaturesType"
                                    class="form-control noselect2 selectpicker"
                                    data-none-selected-text="请选择" multiple
                                    th:with="type=${@dict.getType('di_surface_features')}">
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                        th:value="${dict.dictValue}">
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">调查时间：</label>
                        <div class="col-sm-8">
                           <!-- <div class="input-group date">
                                                    <span class="input-group-addon"><i
                                                            class="fa fa-calendar"></i></span>
                                <input name="surveyTime" type="text" class="form-control"
                                       id="laydate-demo-3" placeholder="yyyy-MM-dd">
                            </div>-->
                            <div class="input-group date">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input id="surveyTime" name="surveyTime" class="form-control" placeholder="yyyy-MM-dd" type="text" required>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">植被覆盖度：</label>
                        <div class="col-sm-8">
                            <input name="vegetationCoverage" class="form-control" type="text">
                        </div>
                    </div>
                </div>
                <!--
                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label class="col-sm-3 control-label">调查人：</label>
                                                        <div class="col-sm-8">
                                                            <input name="name" class="form-control" type="text">
                                                        </div>
                                                    </div>
                                                </div>-->


            </div>


            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">土壤类型：</label>
                        <div class="col-sm-8">
                            <div class="input-group">
                                <input id="suggest-demo-1" name="soilType" class="form-control noselect2 selectpicker" type="text"  >
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-white dropdown-toggle" data-toggle="dropdown">
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-right" role="menu">
                                    </ul>
                               </div>
                            </div>



                          <!--  <select name="soilType" class="form-control noselect2 selectpicker"
                                    th:with="type=${@dict.getType('di_soil')}">
                                <option value="">请选择</option>
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                        th:value="${dict.dictValue}">
                                </option>
                            </select>-->

                        </div>
                    </div>
                </div>
           <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">草地类型：</label>
                        <div class="col-sm-8" >
                         <!--   <select name="grasslandType" class="form-control noselect2 selectpicker"
                                     th:with="type=${@dict.getType('di_grassland')}">
                                 <option value="">请选择</option>
                                 <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                         th:value="${dict.dictValue}">
                                 </option>
                             </select>-->
                                <input name="grasslandType" id="grasslandType" class="form-control" type="text" placeholder="样地绘图自动回显值">

                        </div>
                    </div>
                </div>
            </div>

            <!--   <div class="row">
                 <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label">植被覆盖度：</label>
                         <div class="col-sm-8">
                             <input name="vegetationCoverage" class="form-control" type="text">
                         </div>
                     </div>
                 </div>
               <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label">地上生物量：</label>
                         <div class="col-sm-8">
                             <input name="aboveGroundBiomass" class="form-control" type="text">
                         </div>
                     </div>
                 </div>
            </div>-->

            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">天敌种类：</label>
                        <div class="col-sm-8">
                            <select name="naturalEnemyType"
                                    class="form-control noselect2 selectpicker"
                                    data-none-selected-text="请选择" multiple
                                    th:with="type=${@dict.getType('di_natural_enemy')}">
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                        th:value="${dict.dictValue}">
                                </option>
                            </select>

                        </div>
                    </div>
                </div>

                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">主要植物：</label>
                        <div class="col-sm-8">

                            <select name="mianBotanyType"
                                    class="form-control noselect2 selectpicker"
                                    data-none-selected-text="请选择" multiple
                                    th:with="type=${@dict.getType('di_mian_botany')}">
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                        th:value="${dict.dictValue}">
                                </option>
                            </select>
                        </div>
                    </div>
                </div>


            </div>
            <!--     <div class="row">
                     <div class="col-sm-6">
                         <div class="form-group">
                             <label class="col-sm-3 control-label">地表特征：</label>
                             <div class="col-sm-8">
                                 <select name="surfaceFeaturesType"
                                         class="form-control noselect2 selectpicker"
                                         data-none-selected-text="请选择" multiple
                                         th:with="type=${@dict.getType('di_surface_features')}">
                                     <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                             th:value="${dict.dictValue}">
                                     </option>
                                 </select>
                             </div>
                         </div>
                     </div>
                 </div>-->
            <input name="longitude" id="jd" class="form-control" type='hidden' placeholder="例:13.2" onkeyup="value=value.replace(/^\D*(\d*(?:\.\d{0,2})?).*$/g, '$1')">
            <input name="latitude" id="wd" class="form-control" type='hidden' placeholder="例:33.4" onkeyup="value=value.replace(/^\D*(\d*(?:\.\d{0,2})?).*$/g, '$1')">

            <!-- <div class="row">

                 <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label">经度：</label>
                         <div class="col-sm-8">

                         </div>
                     </div>
                 </div>
                 <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label">纬度：</label>
                         <div class="col-sm-8">
                             <input name="latitude" id="wd" class="form-control" type='hidden' placeholder="例:33.4" onkeyup="value=value.replace(/^\D*(\d*(?:\.\d{0,2})?).*$/g, '$1')">
                         </div>
                     </div>
                 </div>
             </div>-->

            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">高程(米)：</label>
                        <div class="col-sm-8">
                            <input name="elevation" class="form-control" type="text" onkeyup="this.value=this.value.replace(/\D/g,'')" placeholder="例如:32">
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">地形：</label>
                        <div class="col-sm-8">
                            <input name="topographyType" class="form-control" type="text" placeholder="可填:高原、平原、山地、丘陵、盆地">
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">




                <!--<div  style="padding-left: 255px;">
                        <a class="btn btn-success" onclick="ht()" >
                            <i class="fa fa-plus"></i> 添加绘图
                        </a>
                </div>-->
            </div>

        </div>
        <!-- <h1>样地位置信息</h1>
         <fieldset>
             <div class="row">

                 <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label">经度：</label>
                         <div class="col-sm-8">
                             <input name="longitude" id="jd" class="form-control" type="text">
                         </div>
                     </div>
                 </div>
                 <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label">纬度：</label>
                         <div class="col-sm-8">
                             <input name="latitude" id="wd" class="form-control" type="text">
                         </div>
                     </div>
                 </div>
             </div>

             <div class="row">
                 <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label">高程：</label>
                         <div class="col-sm-8">
                             <input name="elevation" class="form-control" type="text">
                         </div>
                     </div>
                 </div>
                 <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label">地形：</label>
                         <div class="col-sm-8">
                             <input name="topographyType" class="form-control" type="text">
                         </div>
                     </div>
                 </div>
             </div>
             <div class="row">
                 <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label">坡位：</label>
                         <div class="col-sm-8">
                             <input name="slopePositionType" class="form-control" type="text">
                         </div>
                     </div>
                 </div>


                 <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label">坡向：</label>
                         <div class="col-sm-8">
                             <input name="asceptType" class="form-control" type="text">
                         </div>
                     </div>
                 </div>

             </div>
             <div class="row">

                 <div class="col-sm-6">
                     <div class="form-group">
                         <label class="col-sm-3 control-label">坡度：</label>
                         <div class="col-sm-8">
                             <input name="fallingGradient" class="form-control" type="text">
                         </div>
                     </div>
                 </div>




                 &lt;!&ndash;<div  style="padding-left: 255px;">
                         <a class="btn btn-success" onclick="ht()" >
                             <i class="fa fa-plus"></i> 添加绘图
                         </a>
                 </div>&ndash;&gt;
             </div>


             &lt;!&ndash;<div class="row">
             <div class="col-sm-6">
                 <div class="form-group">
                     <div class="btn-group-sm" id="toolbar" role="group">
                         <a class="btn btn-success" onclick="bjht()" >
                             <i class="fa fa-plus"></i> 编辑绘图
                         </a>
                     </div>
                 </div>
             </div>
               </div>&ndash;&gt;
         </fieldset>-->

        <h4 class="form-header h4">样地照片</h4>

        <div class="col-sm-pt">
            <div class="form-group1"  >

                <div class="file-loading" style="height: 100px">
                    <input id="fileinput-demo-2" name="photo" type="file"  accept="image/*" multiple >
                </div>

                <!--  <div class="row">
                      <div class="col-sm-11">
                          <div class="form-group1" style="color: red">
                              注：上传图片格式'jpg', 'gif', 'png','bmp','jpeg';<br>
                              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 单次最多上传图片数量10个;<br>
                              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 单个图片限制大小10MB。

                          </div>
                      </div>
                  </div>-->
            </div>
        </div>
        <!--<h4 class="form-header h4">取样信息</h4>-->
        <!-- <div class="col-sm-12 search-collapse quyangAdd">
             <form id="formId">
                 <div class="select-list">
                     <ul>
                         <li>
                             <p class="Addtitle">请选择取样生物种类：</p>
                             <select id="Addtitle" name="harmfulSpeciesType"
                                     th:with="type=${@dict.getType('di_qu_Biological_species')}">
                                 <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                         th:value="${dict.dictValue}">
                                 </option>
                             </select>
                         </li>
                         <li>
                             <a class="btn btn-success" onclick="addTabQuy()"><i
                                     class="fa fa-plus"></i> 添加</a>
                         </li>
                     </ul>
                 </div>
             </form>
         </div>-->

        <!--   <div class="col-sm-12 select-table table-striped">

               <table id="bootstrap-table3"></table>

           </div>-->


    </form>
    <div class="footeer">
        <div class="button-p" >
            <button type="button" class="btn btn-w-m btn-primary" th:onclick="saveYiQy()"  >保存并新增取样</button>&nbsp;
            <button type="button" class="btn btn-w-m btn-primary" th:onclick="saveYi()"  ></i>保 存</button>&nbsp;

            <button type="button" class="btn btn-w-m btn-danger" onclick="successCallback1()"></i>关 闭 </button>
        </div>
    </div>
</div>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: datetimepicker-js"/>
<th:block th:include="include :: bootstrap-fileinput-js"/>
<th:block th:include="include :: select2-js"/>
<th:block th:include="include :: bootstrap-select-js"/>
<th:block th:include="include :: uploadImg-js"/>
<th:block th:include="include :: bootstrap-suggest-js" />
<script type="text/javascript">

    var prefix = ctx + "caiji/survey";

    var prefix2 = ctx + "caiji/plot";

</script>
<script type="text/javascript">
    //取样id值
    var grounid = "";

    // ===== 获取经纬度 =====
    function getlngLat() {
        var addrArea = $("#addrArea").val();
        var addrCity = $("#addrCity").val();
        var url = ctx + "caiji/survey/getlngLat";
        $.ajax({
            "url": url,
            "data": {addrArea: addrArea, addrCity: addrCity},
            "type": "GET",
            "dataType": "json",
            "success": function (data) {
                if (data == null) {
                    layer.alert("未选择地区")
                } else {
                    var centre = data.centre.split(",");

                    $("#jd").val(centre[0]);//赋值给一个id为ridStr的input文本框
                    $("#wd").val(centre[1]);//赋值给一个id为ridStr的input文本框

                }
            }
        });

    }



    function successCallback1() {

        refreshItem("/caiji/survey");
        closeItem();


        $.modal.alertWarning(result.msg)

        $.modal.alertError(result.msg);
        $.modal.closeLoading();
        $.modal.enable();
    }

    /** 刷新选项卡 */
    function refreshItem(currentId) {
        var topWindow = $(window.parent.parent.document);
        var target = $('.RuoYi_iframe[data-id="' + currentId + '"]', topWindow);
        var url = target.attr('src');
        target.attr('src', url).ready();
    };
    //样地保存
    function saveYi(){
        if ($.validate.form('form-survey-add')) {

            $.modal.confirm("确认要保存吗？", function () {
                var formData = new FormData(document.getElementById("form-survey-add"));
               if(savefiles.length>0){
                    alert(savefiles.length);
                    for(var i=0;i<savefiles.length;i++){
                        formData.append("file", savefiles[i]);
                    }
                }
              /* var files1=$("#fileinput-demo-2")[0].files ;
                console.log(files1);
                for(var i=0;i<files1.length;i++){
                    formData.append("file", document.getElementById("fileinput-demo-2").files[i]);
                }*/
                var  url=prefix+"/addY";
                $.ajax({
                    url: url,
                    type: 'post',
                    cache: false,
                    data: formData,
                    dataType:'json',
                    contentType: false,
                    processData: false,
                    success: function (result) {
                        $.operate.successCallback(result);
                    }
                });

            })


        }
    }
   var savefiles=[];
    var jishuUp=0;//记录上传次数，默认次数为1.
    //样地保存并新增取样信息
    function saveYiQy() {

        if ($.validate.form('form-survey-add')) {
           // let gis_id = sessionStorage.getItem("gis_id");
           // $("#mapId").val(gis_id);
            $.modal.confirm("确认保存吗?", function () {
                //saveTab(prefix + "/add", $('#form-sczj-add').serialize());
                /*    $.operate.save(prefix + "/addYQ", $('#form-sczj-add').serialize());*/
                var formData = new FormData(document.getElementById("form-survey-add"));

             /*   if(savefiles.length>0){
                    alert(savefiles.length);
                    for(var i=0;i<savefiles.length;i++){
                        formData.append("file", savefiles[i]);
                    }
                }*/
                var files1=$("#fileinput-demo-2").get(0).files ;
                for(var i=0;i<files1.length;i++){
                    formData.append("file", document.getElementById("fileinput-demo-2").files[i]);
                }

                var  url=prefix+"/addY";
                $.ajax({
                    url: url,
                    type: 'post',
                    cache: false,
                    data: formData,
                    dataType:'json',
                    contentType: false,
                    processData: false,
                    success: function (result) {
                        //$.operate.successCallback(result);
                        $.modal.parentTab("新增取样信息", prefix2+"/addY/"+result.groundId);
                    }
                });

            });


        }
    }

    $(document).ready(function () {
        $("input[name='surveyTime']").datetimepicker({
            format: "yyyy-mm-dd",
            minView: "month",
            autoclose: true,
            initialDate: new Date()
        });
        $("#surveyTime").datetimepicker("setDate", new Date());




        //附件上传
        var obj = document.getElementById("photoUrl");//储存图图片id

        $(".kv-file-remove").click(function () {

             //alert("target"+JSON.stringify( $(this).target));
        });
        /*$('#fileinput-demo-2').on('filepredelete', function(event,data,jax,key) {
             alert("key"+JSON.stringify(key));
             alert("data"+JSON.stringify(data));
             alert("jax"+JSON.stringify(jax));
             alert("event"+JSON.stringify(event));
             console.log('Key = ' + key);

         });*/
        $("#fileinput-demo-2").on("filebatchselected", function(event, files) {
            savefiles=[];
            console.log(event);
            console.log(files);
            for(var item in files) { //item遍历数组时为数组的下标，遍历对象时为对象的key值
                console.log(item); // 1, 2, 3
                var values=files[item].file;
                savefiles.push(values);
                console.log(values);
            };

            jishuUp++;
            console.log(jishuUp+"------"+savefiles);
            alert(savefiles.length);
        });

        $("#fileinput-demo-2").on("fileuploaded", function (event, data, previewId, index) {
            //alert("data"+JSON.stringify(data));
            initialPreview.push(data.response.initialPreview)
            var obj = {
                caption: data.response.filename,
                size: data.response.size,
                url: prefix + '/delete',
                key: data.response.id,
            }
            // alert(JSON.stringify(obj));
            initialPreviewConfig.push(obj);
            //alert(JSON.stringify(initialPreview));
            ids=[];
            for (var i = 0; i < initialPreviewConfig.length; i++) {
                ids.push(initialPreviewConfig[i].key)
            }
            //alert("ids"+ids);
            $("#photoUrl").val(ids);
            // alert("obj"+$("#photoUrl").val())
            $('#fileinput-demo-2').fileinput('destroy');
            $("#fileinput-demo-2").fileinput({
                'theme': 'explorer-fas',
                'uploadUrl': prefix + '/upload',
                overwriteInitial: false,
                uploadIcon: "<i class=\"glyphicon glyphicon-upload\"></i>",
                initialPreviewAsData: true,
                showPreview:true,
                uploadAsync: true,
                showBrowse:true,
                showCancel: false,
                allowedFileExtensions: ['jpg', 'gif', 'png', 'bmp', 'jpeg'],//指出带有哪些后缀名的文件才是被接受上传的
                previewFileIcon: '',//当文件无法被预览时出现在缩略图中的图标，默认是
                maxFileCount: 10,
                layoutTemplates: {
                    actionUpload: ""
                },
                deleteExtraData: {
                    files: "111111111"
                },
                initialPreview: initialPreview,
                initialPreviewConfig: initialPreviewConfig,


            })
            $('#fileinput-demo-2').fileinput('enable');

        });

        function dianji() {
            //  alert(initialPreview);
            // alert(JSON.stringify(initialPreviewConfig));
            // alert($("#photoUrl").val());
        }

        //数组排序方法
        function evlabc(a) { //排序大小
            var i = j = t = 0;
            for (i = 0; i < a.length; i++) {
                for (j = 0; j < a.length; j++) {
                    if (a[i] < a[j]) {// 相邻元素两两对比
                        t = a[i];
                        a[i] = a[j];
                        a[j] = t;
                    }
                }
            }
            return a;
        }

        //取值在数组中的下标
        function indexOfArry(arry, val) {
            for (var i = 0; i < arry.length; i++) {
                if (arry[i] == val) return i;
            }
            return -1;
        };
        function indexOfArry1(arry, val) {
            for (var i = 0; i < arry.length; i++) {
                if (arry[i].key== val) return i;
            }
            return -1;
        };

        //删除数组中固定的值
        function removearry(arry, val) {
            var index = indexOfArry(arry, val);
            if (index > -1) {
                arry.splice(index, 1);
            }
        };

        function removearryUrl(arry1,arry2 ,val) {
            var index = indexOfArry1(arry2, val);
            if (index > -1) {
                arry1.splice(index, 1);
                arry2.splice(index, 1);
            }
        };


    });


    //取样添加
    function addTabQuy() {
        // alert(1)
        var type = $('#Addtitle option:selected').val();
        alert(type);
        // alert(type)
        var url = "";
        var title = "";
        if (type == 001) {
            //害虫
            url = prefix + '/addPest/' + grounid;
            title = "新增害虫信息";
            alert(url);
            // $.modal.open("新增害虫信息", url);

            // $.modal.msgError("请选择添加取样生物类型");
        } else if (type == 002) {
            //害鼠
            url = prefix + '/addVermin/' + grounid;
            title = "新增害鼠信息";
            //$.modal.open("新增害鼠信息", url);
            // $.modal.msgError("请选择添加取样生物类型");
        } else if (type == 003) {
            //病害
            url = prefix + '/addDisease/' + grounid;
            title = "新增病害信息";
            //$.modal.open("新增病害信息", url);
            // $.modal.msgError("请选择添加取样生物类型");
        } else if (type == 004) {
            //毒害草
            url = prefix + '/addWeed/' + grounid;
            title = "新增毒害草信息";
            // $.modal.open("新增毒害草信息", url);
            // $.modal.msgError("请选择添加取样生物类型");
        }
        $.modal.open(title, url);

    }




    function detail(id) {
        var url = prefix + "/detail/" + id;
        $.modal.open("详情", url);
        /* var  type=$('#Addtitle option:selected') .val();
         var  typetext=$('#Addtitle option:selected') .text();
         var samplingArea=$('#samplingArea option:selected').val();
         var samplingAreatext=$('#samplingArea option:selected').text();
         var url="";
         var title="";
         if(type==001){
             //害虫
             url = prefix + '/addPest';
             title="新增害虫信息";
             // $.modal.open("新增害虫信息", url);
             // $.modal.msgError("请选择添加取样生物类型");
         }else if(type==002){
             //害鼠
             url = prefix + '/addVermin';
             title="新增害鼠信息";
             //$.modal.open("新增害鼠信息", url);
             // $.modal.msgError("请选择添加取样生物类型");
         }else if(type==003){
             //病害
             url = prefix + '/addDisease';
             title="新增病害信息";
             //$.modal.open("新增病害信息", url);
             // $.modal.msgError("请选择添加取样生物类型");
         }else if(type==004){
             //毒害草
             url = prefix + '/addWeed';
             title="新增毒害草信息";
             // $.modal.open("新增毒害草信息", url);
             // $.modal.msgError("请选择添加取样生物类型");
         }
         layer.open({
             type: 2,
             area: ["900px", '500px'],
             fix: false,
             //不固定
             maxmin: true,
             shade: 0.3,
             title: title,
             content: url,
             btn: ['确定', '关闭'],
             yes: function (index, layero) {
                 var iframeWin = layero.find('iframe')[0];
                 var code = iframeWin.contentWindow.chuanzhi();
                 if (code == false) {

                 } else {
                     addTab5(code,type,typetext,samplingArea,samplingAreatext);

                     layer.close(index);
                 }

             },
             cancel: function (index) {
                 return true;
             }
         });

 */
        /*$.modal.openTab("查看地面调查数据页面",prefix + "/detail/"+id);*/
        /* detailUrl: prefix + "/detail/{id}",*/
        //害虫
        /* url = prefix + "/detail/"+id;
         title="信息";
         $.modal.open("新增害虫信息", url);*/
        // $.modal.msgError("请选择添加取样生物类型");

        /*layer.open({
            type: 2,
            area: ["900px", '500px'],
            fix: false,
            //不固定
            maxmin: true,
            shade: 0.3,
            title: title,
            content: url,
            btn: ['确定', '关闭'],
            /!*yes: function (index, layero) {
                var iframeWin = layero.find('iframe')[0];
                var code = iframeWin.contentWindow.chuanzhi();
                if (code == false) {

                } else {
                    addTab5(code,type,typetext,samplingArea,samplingAreatext);

                    layer.close(index);
                }

            },*!/
           /!* cancel: function (index) {
                return true;
            }*!/
        });*/


    }


    //取样添加
    function editType(plotId) {
        alert(plotId)

        var type = $('#Addtitle option:selected').val();
        var url = "";
        var title = "";
        if (type == 001) {
            alert("hc")
            //害虫
            url = prefix + '/addPest/' + grounid;
            title = "修改害虫信息";

            // $.modal.open("新增害虫信息", url);

            // $.modal.msgError("请选择添加取样生物类型");
        } else if (type == 002) {
            alert("hs")

            //害鼠
            url = prefix + '/addVermin/' + grounid;
            title = "修改害鼠信息";
            //$.modal.open("新增害鼠信息", url);
            // $.modal.msgError("请选择添加取样生物类型");
        } else if (type == 003) {
            alert("bh")

            //病害
            url = prefix + '/addDisease/' + grounid;
            title = "修改病害信息";
            //$.modal.open("新增病害信息", url);
            // $.modal.msgError("请选择添加取样生物类型");
        } else if (type == 004) {
            alert("dh")

            //毒害草
            url = prefix + '/addWeed/' + grounid;
            title = "修改毒害草信息";
            // $.modal.open("新增毒害草信息", url);
            // $.modal.msgError("请选择添加取样生物类型");
        }
        $.modal.open(title, url);

    }

    function edit() {
        alert(1)
        var type = $('#Addtitle option:selected').val();
        var typetext = $('#Addtitle option:selected').text();
        var samplingArea = $('#samplingArea option:selected').val();
        var samplingAreatext = $('#samplingAreatext option:selected').text();
        var url = "";
        var title = "";
        if (type == 001) {
            //害虫
            url = prefix + '/editc';
            title = "新增害虫信息";
            // $.modal.open("新增害虫信息", url);

            // $.modal.msgError("请选择添加取样生物类型");
        } else if (type == 002) {
            //害鼠
            url = prefix + '/edits';
            title = "新增害鼠信息";
            //$.modal.open("新增害鼠信息", url);
            // $.modal.msgError("请选择添加取样生物类型");
        } else if (type == 003) {
            //病害
            url = prefix + '/editb';
            title = "新增病害信息";
            //$.modal.open("新增病害信息", url);
            // $.modal.msgError("请选择添加取样生物类型");
        } else if (type == 004) {
            //毒害草
            url = prefix + '/editd';
            title = "新增毒害草信息";
            // $.modal.open("新增毒害草信息", url);
            // $.modal.msgError("请选择添加取样生物类型");
        }
        layer.open({
            type: 2,
            area: ["900px", '500px'],
            fix: false,
            //不固定
            maxmin: true,
            shade: 0.3,
            title: title,
            content: url,
            btn: ['确定', '关闭'],
            yes: function (index, layero) {
                var iframeWin = layero.find('iframe')[0];
                var code = iframeWin.contentWindow.chuanzhi();
                if (code == false) {

                } else {
                    addTab5(code, type, typetext, samplingArea, samplingAreatext);

                    layer.close(index);
                }

            },
            cancel: function (index) {
                return true;
            }
        });
    }

    //取样信息父页面赋值添加
    function addTab5(obj, type, typetext, samplingAreatext) {
        var number = 0;
        var tableNode = document.getElementById("bootstrap-table");
        var trNodeList = tableNode.getElementsByTagName("tr");
        /*if(obj.samplingNumber=undefined){

        }*/

        //得到最后一行(tr)的所有td
        if (trNodeList.length == 1) {
            number = 0;
        } else {
            var tdNodeList = trNodeList[trNodeList.length - 1].getElementsByTagName("td");
            var td_input_name = tdNodeList[0].getElementsByTagName("input")[0].name;
            var strIndex = td_input_name.indexOf("[");
            number = td_input_name.substring(strIndex + 1, strIndex + 2);

            number++;
        }


        $("#bootstrap-table").append(" <tbody><tr class=\"shunum\">\n" +
            "                        <td class=\"tg-lboi\">\n" +
            "                          <input name=\"cPlotList[" + number + "].samplingNumber\" class=\"form-control\" value=\"" + obj.samplingNumber + "\" type=\"text\" style='width: 100px' disabled >\n" +
            "                        </td>\n" +
            "                        <td class=\"tg-lboi\">\n" +
            "                          <input name=\"cPlotList[" + number + "].samplingArea\" class=\"form-control\" value=\"" + samplingAreatext + "\" type=\"hidden\" style='width: 200px'  disabled >\n" +
            "                         <input  class=\"form-control\" value=\"" + samplingAreatext + "\" type=\"text\" style='width: 90px' disabled>\n" +
            "                        </td>\n" +
            "                        <td class=\"tg-lboi\">\n" +
            "                         <input name=\"cPlotList[" + number + "].harmfulSpeciesType\" class=\"form-control\" value=\"" + type + "\" type=\"hidden\"  disabled>\n" +
            "                         <input  class=\"form-control\" value=\"" + typetext + "\" type=\"text\" style='width: 90px' disabled>\n" +
            "                        </td>\n" +
            "                        <td class=\"tg-lboi\">\n" +
            "                            <input name=\"cPlotList[" + number + "].detailedType\" value=\"" + obj.detailedType + "\" class=\"form-control\" type=\"text\" style='width: 100px' disabled>\n" +
            "                        </td>\n" +
            "                        <td class=\"tg-lboi\">\n" +
            "                            <input name=\"cPlotList[" + number + "].quantityDetermination\"  value=\"" + obj.quantityDetermination + "\" class=\"form-control\" style='width: 110px' type=\"text\" disabled>\n" +
            "                        </td>\n" +

            "                        <td class=\"tg-lboi\">\n" +
            "                            <input name=\"cPlotList[" + number + "].standardDensity\" value=\"" + obj.standardDensity + "\" class=\"form-control\" type=\"text\" style='width: 110px' disabled></div>\n" +
            "                        </td>\n" +
            "                        <td class=\"tg-lboi\">\n" +
            "                            <input name=\"cPlotList[" + number + "].samplingTime\" value=\"" + obj.samplingTime + "\" class=\"form-control laydate-demo-32\" style='width: 110px' type=\"text\"  placeholder=\"yyyy-MM-dd HH:mm\" disabled>\n" +
            "                        </td>\n" +
            "                        <td class=\"tg-lboi\">\n" +
            "                            <div class=\"tg-lboi\">\n" +
            "                                <a class=\"btn btn-success\" onclick=addTab1(\"cPlotList" + number + "photo\")  style='width: 100px'>\n" +
            "                                    <i class=\"fa fa-plus\"></i> 上传\n" +
            "                            <input id=\"cPlotList[" + number + "]photo\" name=\"cPlotList[" + number + "].photo\" class=\"form-control\" type=\"hidden\">\n" +
            "                                </a>\n" +
            "                            </div>\n" +
            "                        </td>  <td class=\"tg-lboi\">\n" +
            "                            <div class=\"tg-lboi\">\n" +
            "                                <a class=\"btn btn-success \"  onclick=\"eidt(this)\" style='width: 100px' >\n" +
            "                                    <i class=\"fa fa-plus\" ></i> 修改\n " +
            "                                </a>\n" +
            "                                <a class=\"btn btn-success \"   onclick=\"detail(this)\" style='margin-top: 5px;width: 100px' >\n" +
            "                                    <i class=\"fa fa-info\" ></i> 详情\n " +
            "                                </a>\n" +
            "                                <a class=\"btn btn-danger multiple \" onclick=\"addTab3(this)\" style='margin-top: 5px;width: 100px' >\n" +
            "                                    <i class=\"fa fa-remove\"></i> 删除\n" +
            "                                </a>\n" +
            "                            </div>\n" +
            "                        </td>\n" +
            "                    </tr></tbody>")


    }

    function bianhao() {
        layer.open({
            type: 2,
            area: ["900px", '500px'],
            fix: false,
            //不固定
            maxmin: true,
            shade: 0.3,
            title: "样地编号选择",
            content: prefix + "/code",
            btn: ['确定', '关闭'],
            yes: function (index, layero) {
                var iframeWin = layero.find('iframe')[0];
                var code = iframeWin.contentWindow.chuanzhi();
                if (code == false) {

                } else {
                    $("#codeId").val(code);
                    layer.close(index);
                }

            },
            cancel: function (index) {
                return true;
            }
        });

    }



    var dictData = [[${dictDatalist}]];
    //var dictDatas=[[${dictDatalists}]];
    $(function () {

        //行政代码
        var testBsSuggest = $("#suggest-demo-1").bsSuggest({
            url: prefix + "/dictdata/di_soil",
            idField: "dictCode",
            keyField: "dictLabel"
        })







        var prefix1 = ctx + "caiji/plot";
        var options = {
            id: "bootstrap-table3",
            url: prefix1 + "/list3",
            updateUrl: prefix1 + "/edit/{id}",
            removeUrl: prefix1 + "/remove",
            queryParams: {id: grounid},
            pagination: true,
            pageList: [3, 6, 9, 12],//分页步进值
            pageSize: 3,
            showRefresh: false,
            showColumns: false,
            showToggle: false,
            showSearch: false,

            modalName: "取样数据",
            columns: [
                {
                    field: 'id',
                    title: '序号',
                    width: 5,
                    align: 'center',
                    valign: 'middle',
                    switchable: false,
                    formatter: function (value, row, index) {
                        //return index+1; //序号正序排序从1开始
                        var pageSize1 = $('#bootstrap-table3').bootstrapTable('getOptions').pageSize;//通过表的#id 可以得到每页多少条
                        var pageNumber = $('#bootstrap-table3').bootstrapTable('getOptions').pageNumber;//通过表的#id 可以得到当前第几页
                        return pageSize1 * (pageNumber - 1) + index + 1;    //返回每条的序号： 每页条数 * （当前页 - 1 ）+ 序号
                    }
                },
                {
                    field: 'samplingNumber',
                    align: 'center',
                    valign: 'middle',
                    title: '取样编号'
                },
                {
                    field: 'samplingArea',
                    align: 'center',
                    valign: 'middle',
                    title: '取样面积类型'
                },
                {
                    field: 'harmfulSpeciesType',
                    align: 'center',
                    valign: 'middle',
                    title: '有害生物种类',
                    /* formatter:function(value,row,index){
           /!*        $.ajax({
                             "url": prefix + "/dict?dict=di_qu_Biological_species",
                             "type": "GET",
                             "dataType": "json",
                             "success": function (data) {
                                 /!*   console.log(JSON.stringify(data));*!/
                                 var opt = "";
                                 if (data.msg == "操作成功") {
                                     var dictDatalist = data.dictData;
                                     for (var i in dictDatalist) {
                                         alert("dictDatalist[i].dictValue---"+dictDatalist[i].dictValue)
                                         alert("dictDatalist[i].dictLabel---"+dictDatalist[i].dictLabel)
                                         alert(dictDatalist[i].dictValue==row.harmfulSpeciesType)
                                         if(dictDatalist[i].dictValue==row.harmfulSpeciesType)
                                         {
                                             alert("1111111");
                                                       return dictDatalist[i].dictLabel;
                                         }

                                     }


                                 }


                             }
                         });*!/
                         var arrayObj = new Array();
                         for (var i in dictData) {
                             var obj={
                             }
                             obj["dictValue"]=dictData[i]
                             obj["dictLabel"]=dictDatas[i]
                             arrayObj.push(obj);

                         }
                       for (var i in arrayObj) {
                             if(arrayObj[i].dictValue==row.harmfulSpeciesType)
                             {
                                 return arrayObj[i].dictLabel;
                             }

                         }

                     }*/

                },
                {
                    field: 'detailedType',
                    align: 'center',
                    valign: 'middle',
                    title: '具体种类'
                },
                {
                    field: 'quantityDetermination',
                    align: 'center',
                    valign: 'middle',
                    title: '测定数量'
                },
                /*{
                    field : 'photo',
                    align: 'center',
                    valign: 'middle',
                    title : '照片'
                },*/
                /*{
                    field : 'status',
                    align: 'center',
                    valign: 'middle',
                    title : '状态',
                    formatter: function (value, row, index) {
                        return statusTool(row);
                    }
                },*/

                {
                    title: '操作',
                    align: 'center',
                    valign: 'middle',
                    formatter: function (value, row, index) {
                        var actions = [];
                        actions.push('<a class="btn btn-danger btn-xs " href="javascript:void(0)" onclick="$.operate.remove(\'' + row.plotId + '\')"><i class="fa fa-remove"></i>删除</a>&nbsp');
                        actions.push('<a class="btn btn-success btn-xs " href="javascript:void(0)" onclick="$.operate.edit(\'' + row.plotId + '\')"><i class="fa fa-edit"></i>编辑</a>  ');
                        return actions.join('');
                    }
                }
            ]
        };
        $.table.init(options);
    });

    function statusTool(row) {
        if (row.status == '0') {
            return '<p>已添加</p> ';
        }
    }




    $(function () {
       // sessionStorage.removeItem("gis_id");
       // sessionStorage.removeItem("grasslandType");
    })

    function ht() {
       // let gis_id = sessionStorage.getItem("gis_id");
        var mapId = $("#mapId").val();
        if (mapId == null||mapId=="") {
            var addrArea = $("#addrArea").val();
            if (addrArea == "") {
                addrArea = '-1'
            }
            var addrCity = $("#addrCity").val();
            if (addrCity == "") {
                addrCity = '-1'
            }
            var prefix = ctx + "system/gisMap";
            var url = prefix + '/getListCaoYuanGisMap/' + addrArea + '/' + addrCity;
            $.modal.open("新建绘图", url, '850', '650');


        } else {

            hiddenht();

        }
    }

    function hiddenht() {
        var gis_id = $("#mapId").val();
        if(gis_id ==null || gis_id ==''){
            var prefix = ctx + "system/gisMap";
            var url = prefix + '/getGisMap/' + 0;
            $.modal.open("新建绘图", url, '850', '650');

        }else{

            var mapId = gis_id;
            var prefix = ctx + "system/gisMap";
            var url = prefix + '/getGisMap/' + mapId;
            $.modal.open("编辑绘图", url, '850', '650');

        }


    }

    function bjht() {
        var prefix = ctx + "system/gisMap";
        var url = prefix + '/getbjListCaoYuanGisMap';
        $.modal.open("编辑绘图", url, '880', '650');

    }
    function huixianCtyoe() {
        let gis_id = sessionStorage.getItem("grasslandType");
        if(gis_id ==null || gis_id ==''||gis_id==undefined||gis_id=="undefined"){

            alert("请先绘图，再选择！")
        }else{
            $("#huixianCtyoe").hide();
            $("#grasslandType").val(gis_id);
            $("#huixianCtyoe1").show();
        }

    }



</script>

</body>
</html>